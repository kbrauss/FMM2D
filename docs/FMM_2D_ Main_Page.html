<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0048)file:///home/dbpc/git/FMM2D/docs/html/index.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=9">
<meta name="generator" content="Doxygen 1.8.6">
<title>FMM 2D: Main Page</title>
<link href="./FMM_2D_ Main_Page_files/tabs.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="./FMM_2D_ Main_Page_files/jquery.js"></script>
<script type="text/javascript" src="./FMM_2D_ Main_Page_files/dynsections.js"></script>
<link href="./FMM_2D_ Main_Page_files/search.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="./FMM_2D_ Main_Page_files/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="./FMM_2D_ Main_Page_files/doxygen.css" rel="stylesheet" type="text/css">
<link href="./FMM_2D_ Main_Page_files/customdoxygen.css" rel="stylesheet" type="text/css">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">FMM 2D
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="file:///home/dbpc/git/FMM2D/docs/html/index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="file:///home/dbpc/git/FMM2D/docs/html/pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="file:///home/dbpc/git/FMM2D/docs/html/files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="./FMM_2D_ Main_Page_files/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt="">
          <input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="./FMM_2D_ Main_Page_files/close.png" alt=""></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">â€¢</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" name="MSearchResults" id="MSearchResults" src="./FMM_2D_ Main_Page_files/saved_resource.html">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">FMM 2D Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/Main_8cc.html">Main.cc</a></p>
<dl class="section date"><dt>Date</dt><dd>Created on: Jun 20, 2016 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Keith D Brauss</dd></dl>
<h1><a class="anchor" id="section_toc"></a>
Table of Contents</h1>
<ul>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#introduction_section">Introduction</a>  </li>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#complex_analysis_section">Complex Analysis Review</a>  <ul>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#complex_plane_subsection">Complex Plane</a>  </li>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#complex_exponential_function_subsection">Complex Exponential Function</a>  </li>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#complex_logarithmic_function_subsection">Complex Logarithmic Function</a>  </li>
</ul>
</li>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#mlfmm_2d_transformations_section">MLFMM 2D Transformations</a>  <ul>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#approximating_the_potential_subsection">Approximating the Potential Function</a>  </li>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#field_expansion_subsection">S and R Expansions</a>  <ul>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#far_field_expansion_subsubsection">S-Expansion (Far-Field Expansion)</a>  </li>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#near_field_expansion_subsubsection">R-Expansion (Near-Field Expansion)</a>  </li>
</ul>
</li>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#translation_subsection">Translations</a>  <ul>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#local_to_local_translation_subsubsection">(R|R) Translation (local-to-local translation)</a>  </li>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#far_to_near_translation_subsubsection">(S|R) Translation (far-to-near translation)</a>  </li>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#far_to_far_translation_subsubsection">(S|S) Translation (far-to-far translation)</a>  </li>
</ul>
</li>
</ul>
</li>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#mlfmm_algorithm_section">MLFMM Algorithm</a>  <ul>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#quadtree_partition_subsection">Quadtree Partition</a>  </li>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#far_field_expansion_subsection">Far-Field Expansions</a>  </li>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#upward_pass_subsection">Upward Pass</a>  </li>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#downward_pass_subsection">Downward Pass</a>  </li>
</ul>
</li>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#mlfmm_complexity_section">MLFMM Complexity</a>  <ul>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#slfmm_complexity_subsection">Single Level FMM Complexity</a>  </li>
</ul>
<ul>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#mlfmm_complexity_subsection">MultiLevel FMM Complexity</a>  </li>
</ul>
<ul>
<li>
<a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/index.html#mlfmm_with_translation_operators_complexity_subsection">Complexity of MultiLevel FMM with Translation Operators</a>  </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="introduction_section"></a>
Introduction</h1>
<p>This code implements the Fast Multipole Method (FMM) in two dimensions (2D) for the calculation of the elecctric potential experienced by a particle <img class="formulaInl" alt="$y_j$" src="./FMM_2D_ Main_Page_files/form_0.png"> from the presence of charged particles <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png">. The potential function describing the action (from a distance) of <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> on <img class="formulaInl" alt="$y_j$" src="./FMM_2D_ Main_Page_files/form_0.png"> is given by the formula </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[\phi_{ji} = q_i \ln ( \|y_j - x_i\| )\]" src="./FMM_2D_ Main_Page_files/form_2.png">
</p>
<p> where <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> and <img class="formulaInl" alt="$y_j$" src="./FMM_2D_ Main_Page_files/form_0.png"> are the coordinates for particles in two-dimensional space and <img class="formulaInl" alt="$q_i$" src="./FMM_2D_ Main_Page_files/form_3.png"> is the charge of particle <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png">. </p>
<ul>
<li>
<img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> and <img class="formulaInl" alt="$y_j$" src="./FMM_2D_ Main_Page_files/form_0.png"> are complex numbers .  </li>
<li>
<img class="formulaInl" alt="$y_j$" src="./FMM_2D_ Main_Page_files/form_0.png"> are target particles (points).  </li>
<li>
<img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> are source particles  </li>
</ul>
<p>For a target particle <img class="formulaInl" alt="$y_j$" src="./FMM_2D_ Main_Page_files/form_0.png"> in the complex plane that encounters action from <img class="formulaInl" alt="$N_s$" src="./FMM_2D_ Main_Page_files/form_4.png"> multiple source particles <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> located in the complex plane (we can think of the xy-plane <img class="formulaInl" alt="$\mathbb{R}^2$" src="./FMM_2D_ Main_Page_files/form_5.png"> since there is a one-to-one correspondece between the complex plane and the xy-plane), the potential is calculated using superposition. </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \sum_{i=1}^{N_s} \phi_{ji} = \sum_{i=1}^{N_s} \ln (\|y_j - x_i\|) q_i = \begin{bmatrix} \ln(\|y_j - x_1\|) &amp; \ln(\|y_j - x_2\|) &amp; \hdots &amp; \ln(\|y_j-x_{N_s}\|) \end{bmatrix} \begin{bmatrix} q_1 \\ q_2 \\ \vdots \\ q_{N_s} \end{bmatrix} \]" src="./FMM_2D_ Main_Page_files/form_6.png">
</p>
<ol type="1">
<li>
The summation above can be viewed as a vector-vector product having an operation count <img class="formulaInl" alt="$O(N_s)$" src="./FMM_2D_ Main_Page_files/form_7.png">.  </li>
<li>
We are interested in performing this operation for a number <img class="formulaInl" alt="$N_t$" src="./FMM_2D_ Main_Page_files/form_8.png"> of target particles <img class="formulaInl" alt="$y_j$" src="./FMM_2D_ Main_Page_files/form_0.png">.  </li>
<li>
Performing the <img class="formulaInl" alt="$N_t$" src="./FMM_2D_ Main_Page_files/form_8.png"> summation operations can be viewed as a matrix-vector product.  </li>
</ol>
<p>The goal of the code and FMM is to minimize the <img class="formulaInl" alt="$O(N^2)$" src="./FMM_2D_ Main_Page_files/form_9.png"> operation count (assuming <img class="formulaInl" alt="$N = N_t = N_s$" src="./FMM_2D_ Main_Page_files/form_10.png">) required to perform the matrix-vector product. To discuss the FMM for two dimensions and for the electrostatic potential function, we need to review some complex numbers and complex analysis.</p>
<h1><a class="anchor" id="complex_analysis_section"></a>
Complex Analysis Review</h1>
<p>For a more in-depth review of complex analysis see Chapter 13 of <a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/citelist.html#CITEREF_kreyszig2010">[1]</a>. Recall the complex plane above.</p>
<h2><a class="anchor" id="complex_plane_subsection"></a>
Complex Plane</h2>
<div class="image">
<img src="./FMM_2D_ Main_Page_files/polar.png" alt="polar.png">
</div>
<p>Consider the complex plane shown above. </p>
<ul>
<li>
the x-axis corresponds to the real axis  </li>
<li>
the y-axis is the imaginary axis  </li>
<li>
the complex number <img class="formulaInl" alt="$z = x + iy$" src="./FMM_2D_ Main_Page_files/form_11.png"> is the point in the complex plane with coordinates <img class="formulaInl" alt="$(x,y)$" src="./FMM_2D_ Main_Page_files/form_12.png"> </li>
<li>
<img class="formulaInl" alt="$\theta$" src="./FMM_2D_ Main_Page_files/form_13.png"> is the angle from the positive x-axis to the complex number (point) <img class="formulaInl" alt="$z = x + iy$" src="./FMM_2D_ Main_Page_files/form_11.png">  </li>
<li>
<img class="formulaInl" alt="$\theta$" src="./FMM_2D_ Main_Page_files/form_13.png"> is called the argument of z, denoted <img class="formulaInl" alt="$arg(z)$" src="./FMM_2D_ Main_Page_files/form_14.png"> ( <img class="formulaInl" alt="$\theta = arg(z)$" src="./FMM_2D_ Main_Page_files/form_15.png">)  </li>
<li>
from the Pythagorean Theorem, the hypotenuse <img class="formulaInl" alt="$r = \|z\| = \sqrt{x^2 + y^2}$" src="./FMM_2D_ Main_Page_files/form_595.png">. </li>
<li>
using trig, we have <img class="formulaInl" alt="$\tan (\theta) = \frac{y}{x}$" src="./FMM_2D_ Main_Page_files/form_16.png">  </li>
<li>
therefore <img class="formulaInl" alt="$z = x + iy = r \cos (\theta) + i r \sin(\theta) = r( \cos(\theta) + i \sin (\theta) $" src="./FMM_2D_ Main_Page_files/form_17.png">  </li>
<li>
using addition formulas <img class="formulaInl" alt="$z_1z_2 = r_1r_2(cos(\theta_1+\theta_2)+i\sin(\theta_1+\theta_2))$" src="./FMM_2D_ Main_Page_files/form_18.png"> where <img class="formulaInl" alt="$z_i = r_i(\cos(\theta_i)+i\sin(\theta_i))$" src="./FMM_2D_ Main_Page_files/form_19.png">  </li>
</ul>
<h2><a class="anchor" id="complex_exponential_function_subsection"></a>
Complex Exponential Function</h2>
<p>Let <img class="formulaInl" alt="$f(z) \colon \mathbb{C} \to \mathbb{C}$" src="./FMM_2D_ Main_Page_files/form_20.png"> be the complex-valued function defined by w = f(z) = u(x,y) + iv(x,y). From the Cauchy-Riemann equations, we have the following formulas for the complex derivative of <img class="formulaInl" alt="$f$" src="./FMM_2D_ Main_Page_files/form_21.png"> </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ f&#39;(z) = \lim_{\Delta z \to 0} \frac{f(z+\Delta z) - f(z)}{\Delta z} = u_x + iv_x = -iu_y + v_y \]" src="./FMM_2D_ Main_Page_files/form_22.png">
</p>
<p>To retain the properties enjoyed by the real-value exponential function, we define the complex exponential function <img class="formulaInl" alt="$f(z) = e^z$" src="./FMM_2D_ Main_Page_files/form_23.png"> for <img class="formulaInl" alt="$z = x + iy$" src="./FMM_2D_ Main_Page_files/form_11.png"> by the formula </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[e^z = e^x (cos(y) + isin(y))\]" src="./FMM_2D_ Main_Page_files/form_24.png">
</p>
<p> The following properties result </p>
<ul>
<li>
<img class="formulaInl" alt="$(e^z)&#39; = e^xcos(y))_x + i(e^xsin(y))_x = e^xcos(y) + ie^xsin(y) = e^z$" src="./FMM_2D_ Main_Page_files/form_25.png">  </li>
<li>
<img class="formulaInl" alt="$e^{z_1 + z_2} = e^{z_1}e^{z_2}$" src="./FMM_2D_ Main_Page_files/form_26.png">  </li>
<li>
<img class="formulaInl" alt="$e^z = e^x (cos(0)+isin(0) = e^x$" src="./FMM_2D_ Main_Page_files/form_27.png"> if <img class="formulaInl" alt="$z = x \in \mathbb{R}$" src="./FMM_2D_ Main_Page_files/form_28.png">  </li>
<li>
<img class="formulaInl" alt="$e^z = e^0(\cos(y)+i\sin(y)) = e^{iy} = \cos(y)+i\sin(y)$" src="./FMM_2D_ Main_Page_files/form_29.png"> if <img class="formulaInl" alt="$z = iy$" src="./FMM_2D_ Main_Page_files/form_30.png"> is purely imaginary  </li>
</ul>
<p>Some important properties of <img class="formulaInl" alt="$z = x + iy$" src="./FMM_2D_ Main_Page_files/form_11.png"> and <img class="formulaInl" alt="$e^z$" src="./FMM_2D_ Main_Page_files/form_31.png"> are </p>
<ul>
<li>
<img class="formulaInl" alt="$z = r(\cos(\theta) + i\sin(\theta)) = re^{i \theta} $" src="./FMM_2D_ Main_Page_files/form_32.png"> (so <img class="formulaInl" alt="$y = \theta = arg(z)$" src="./FMM_2D_ Main_Page_files/form_33.png">)  </li>
<li>
<img class="formulaInl" alt="$e^{2 \pi i} = cos(2 \pi) + i sin(2 \pi) = 1$" src="./FMM_2D_ Main_Page_files/form_34.png">  </li>
<li>
<img class="formulaInl" alt="$e^z = e^xe^{iy} = e^xe^{iy}e^{2 \pi i} = e^{z + 2 \pi i} = e^x e^(y + 2 \pi i)$" src="./FMM_2D_ Main_Page_files/form_35.png">  </li>
<li>
<img class="formulaInl" alt="$arg(e^z) = y +/- 2 n \pi$" src="./FMM_2D_ Main_Page_files/form_36.png">  </li>
<li>
<img class="formulaInl" alt="$\|e^{iy}\| = \|cos(y) + isin(y)\| = cos^2(y) + sin^2(y) = 1$" src="./FMM_2D_ Main_Page_files/form_37.png">  </li>
<li>
<img class="formulaInl" alt="$\|e^z\| = \|e^xe^iy\| = \|e^x\| \|e^iy\| = \|e^x\| = e^x$" src="./FMM_2D_ Main_Page_files/form_38.png">  </li>
</ul>
<h2><a class="anchor" id="complex_logarithmic_function_subsection"></a>
Complex Logarithmic Function</h2>
<p>We define the complex logarithmic function <img class="formulaInl" alt="$w = \ln(z)$" src="./FMM_2D_ Main_Page_files/form_39.png"> for <img class="formulaInl" alt="$z = x + iy$" src="./FMM_2D_ Main_Page_files/form_11.png"> as the inverse of the complex exponential function </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ f(z) = e^z \quad \mbox{and} \quad f^{-1}(z) = \ln(z) \]" src="./FMM_2D_ Main_Page_files/form_40.png">
</p>
<p> by way of the formula </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ w = \ln(z) \quad \iff \quad e^w = z \]" src="./FMM_2D_ Main_Page_files/form_41.png">
</p>
<p>Let the complex numbers <img class="formulaInl" alt="$w = u + iv$" src="./FMM_2D_ Main_Page_files/form_42.png"> and <img class="formulaInl" alt="$z = re^{i \theta}$" src="./FMM_2D_ Main_Page_files/form_43.png">. Recall that <img class="formulaInl" alt="$r = \|z\|$" src="./FMM_2D_ Main_Page_files/form_44.png"> and <img class="formulaInl" alt="$arg(z) = \theta$" src="./FMM_2D_ Main_Page_files/form_45.png">. Then </p>
<ul>
<li>
<img class="formulaInl" alt="$z = e^w \implies e^{u + iv} = re^{i \theta}$" src="./FMM_2D_ Main_Page_files/form_46.png"> and <img class="formulaInl" alt="$e^u = r$" src="./FMM_2D_ Main_Page_files/form_47.png"> and <img class="formulaInl" alt="$v = \theta$" src="./FMM_2D_ Main_Page_files/form_48.png">  </li>
<li>
since <img class="formulaInl" alt="$e^u = r$" src="./FMM_2D_ Main_Page_files/form_47.png"> and <img class="formulaInl" alt="$r \in \mathbb{R}$" src="./FMM_2D_ Main_Page_files/form_49.png">, <img class="formulaInl" alt="$u = \ln(r)$" src="./FMM_2D_ Main_Page_files/form_50.png"> (where <img class="formulaInl" alt="$\ln$" src="./FMM_2D_ Main_Page_files/form_51.png"> is the real natural logarithmic function)  </li>
<li>
therefore <img class="formulaInl" alt="$ln(z) = w = u + iv = ln(r) + i \theta$" src="./FMM_2D_ Main_Page_files/form_52.png">  </li>
<li>
recall that <img class="formulaInl" alt="$arg(z) = \theta$" src="./FMM_2D_ Main_Page_files/form_45.png"> is determined only up to integer multiples of <img class="formulaInl" alt="$2 \pi$" src="./FMM_2D_ Main_Page_files/form_53.png">  </li>
<li>
therefore, <img class="formulaInl" alt="$ln(z)$" src="./FMM_2D_ Main_Page_files/form_54.png"> has infinitely many values and is an infinitely many-valued 'function'  </li>
<li>
that is, <img class="formulaInl" alt="$ln(z) = ln(r) + i(\theta + 2n \pi)$" src="./FMM_2D_ Main_Page_files/form_55.png"> for all <img class="formulaInl" alt="$n \in \mathbb{Z}$" src="./FMM_2D_ Main_Page_files/form_56.png">  </li>
<li>
note <img class="formulaInl" alt="$ln(z) = ln(r) + i(\theta + 2n \pi)$" src="./FMM_2D_ Main_Page_files/form_55.png"> implies that <img class="formulaInl" alt="$\ln(r) = \mbox{Re}(\ln(z))$" src="./FMM_2D_ Main_Page_files/form_57.png">  </li>
<li>
therefore since <img class="formulaInl" alt="$r = \|z\|$" src="./FMM_2D_ Main_Page_files/form_44.png"> we have <img class="formulaInl" alt="$ln(\|z\|) = ln(r) = \mbox{Re} (ln(z))$" src="./FMM_2D_ Main_Page_files/form_58.png">  </li>
</ul>
<h1><a class="anchor" id="mlfmm_2d_transformations_section"></a>
MLFMM 2D Transformations</h1>
<p>The Fast Multipole Method is 'fast' since it has a lower floating point operation count in comparison to the matrix-vector product</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \begin{bmatrix} v_1 \\ v_2 \\ v_3 \\ \vdots \\ v_{N_t} \end{bmatrix} = \begin{bmatrix} \ln(\|y_1-x_1\|) &amp; \ln(\|y_1-x_1\|) &amp; \ln(\|y_1-x_1\|) &amp; \hdots &amp; \ln(\|y_1-x_{N_s}\|) \\ \ln(\|y_2-x_1\|) &amp; \ln(\|y_2-x_1\|) &amp; \ln(\|y_2-x_1\|) &amp; \hdots &amp; \ln(\|y_2-x_{N_s}\|) \\ \ln(\|y_3-x_1\|) &amp; \ln(\|y_3-x_1\|) &amp; \ln(\|y_3-x_1\|) &amp; \hdots &amp; \ln(\|y_3-x_{N_s}\|) \\ \vdots * \vdots &amp; \vdots &amp; &amp; \vdots \\ \ln(\|y_{N_t}-x_1\|) &amp; \ln(\|y_{N_t}-x_1\|) &amp; \ln(\|y_{N_t}-x_1\|) &amp; \hdots &amp; \ln(\|y_{N_t}-x_{N_s}\|) \\ \end{bmatrix} \begin{bmatrix} q_1 \\ q_2 \\ q_3 \\ \vdots \\ q_{N_s} \end{bmatrix} \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_318.png">
</p>
<p>The key to this 'speed' is approximation. The Fast Multipole Method uses finite series approximations of operators. We use Taylor series representations (below) to represent these operations. Our work gives exact representations first (with infinite series). Afterwards, we truncate the infinite series to obatin approximations to the operators.</p>
<p>The first function that we approximate is the natural logarithm. We look at two different Taylor series representations for the function (actually they are the same Taylor series with different centers - one at <img class="formulaInl" alt="$z$" src="./FMM_2D_ Main_Page_files/form_319.png"> and the other at <img class="formulaInl" alt="$t$" src="./FMM_2D_ Main_Page_files/form_164.png">). The reason for using two different series is the radius of convergence. The radius of convergence for the first series will be for values <img class="formulaInl" alt="$y$" src="./FMM_2D_ Main_Page_files/form_79.png"> within a disc of radius <img class="formulaInl" alt="$R_*$" src="./FMM_2D_ Main_Page_files/form_320.png">. The second series will be convergent for <img class="formulaInl" alt="$y$" src="./FMM_2D_ Main_Page_files/form_79.png">-values outside the disc of radius <img class="formulaInl" alt="$R_*$" src="./FMM_2D_ Main_Page_files/form_320.png">. This allows us to take care of all scenarios (except for values on the boundary of the disc, but we assume that (and somehow will have to make sure that) this does not happen for our problems.</p>
<p>The next series approximations are of translation operations that translate a series center from one location to another location. There are three different types of these translations of center that we encounter in the Fast Multipole Method: (i) near-field to near-field translations (local-to-local translations) called the <img class="formulaInl" alt="$R|R$" src="./FMM_2D_ Main_Page_files/form_160.png"> translation (ii) far-field to near-field translations (far-to-near) called the <img class="formulaInl" alt="$S|R$" src="./FMM_2D_ Main_Page_files/form_302.png"> translation, and (iii) far-field to far-field translations (far-to-far) called the <img class="formulaInl" alt="$S|S$" src="./FMM_2D_ Main_Page_files/form_321.png"> translation.</p>
<p>We develop the <img class="formulaInl" alt="$R|R$" src="./FMM_2D_ Main_Page_files/form_160.png"> translation by writing each power <img class="formulaInl" alt="$R_m(y-x_*+t) = (y-x_*+t)^m$" src="./FMM_2D_ Main_Page_files/form_168.png"> where <img class="formulaInl" alt="$m \geq 0$" src="./FMM_2D_ Main_Page_files/form_322.png"> as a Taylor series. Eventually the derivatives of the function <img class="formulaInl" alt="$R_m(y-x_*+t)$" src="./FMM_2D_ Main_Page_files/form_323.png"> will be zero and the Taylor series representation will be finite for each <img class="formulaInl" alt="$R_m(y-x_*+t)$" src="./FMM_2D_ Main_Page_files/form_323.png"> (a nice feature of this translation).</p>
<p>The <img class="formulaInl" alt="$S|R$" src="./FMM_2D_ Main_Page_files/form_302.png"> and <img class="formulaInl" alt="$S|S$" src="./FMM_2D_ Main_Page_files/form_321.png"> translations are developed from the same Taylor series representation but having two different centers (as mentioned with the <img class="formulaInl" alt="$R$" src="./FMM_2D_ Main_Page_files/form_324.png"> and <img class="formulaInl" alt="$S$" src="./FMM_2D_ Main_Page_files/form_325.png"> expansions above). The Taylor series representations that result are binomial series and the combination notation for binomial series is used.</p>
<p>We start with the <img class="formulaInl" alt="$R|R$" src="./FMM_2D_ Main_Page_files/form_160.png"> translation.</p>
<h2><a class="anchor" id="approximating_the_potential_subsection"></a>
Approximating the Potential Function</h2>
<p>From our work above, we see that we can write <img class="formulaInl" alt="$\phi_{ji} = log( \|y_j - x_i\| )$" src="./FMM_2D_ Main_Page_files/form_59.png"> as <img class="formulaInl" alt="$ \phi_{ji} = Re( log( y_j - x_i ) ). $" src="./FMM_2D_ Main_Page_files/form_60.png"> Therefore, we just consider the potential function as </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \phi_{ji} = log( y_j - x_i ). \]" src="./FMM_2D_ Main_Page_files/form_61.png">
</p>
<p> We approximate the potential function by its Taylor series (see Chapter 15 of <a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/citelist.html#CITEREF_kreyszig2010">[1]</a> for a review). Recall the formula for the Taylor series centered at the complex number <img class="formulaInl" alt="$z_0$" src="./FMM_2D_ Main_Page_files/form_62.png">.</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ f(z) = \sum_{n=0}^{\infty} \frac{f^{(n)}(z_0)}{n!} (z-z_0)^n \]" src="./FMM_2D_ Main_Page_files/form_63.png">
</p>
<p>Let <img class="formulaInl" alt="$z = y_j - x_i$" src="./FMM_2D_ Main_Page_files/form_64.png"> and consider the Taylor expansion for <img class="formulaInl" alt="$f(z) = \log(z) = \log(y_j - x_i)$" src="./FMM_2D_ Main_Page_files/form_65.png"></p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} f(z) &amp; = &amp; \sum_{n=0}^{\infty} \frac{ f^{(n)}(z_0) }{ n! } (z - z_0)^{n} \\ &amp; = &amp; f(z_0) + \frac{f&#39;(z_0)}{1!} (z - z_0)^1 + \frac{1}{2!} f&#39;&#39;(z_0)(z-z_0)^2 + \frac{f&#39;&#39;&#39;(z_0)}{3!} (z-z_0)^3 + \frac{f^{(4)}(z_0)}{4!} (z-z_0)^4 + ... + \frac{f^{(n)}(z_0)}{n!} (z-z_0)^n + ... \\ &amp; = &amp; ln(z_0) + \frac{1}{1!} \frac{z-z_0}{z_0} + \frac{(-1)^1}{2} \frac{z-z_0}{z_0} + \frac{(-1)^2}{3} \frac{(z-z_0)^3}{z_0^3} + \frac{(-1)^3}{4} \frac{(z-z_0)^4}{z_0^4} + ... + \frac{(-1)^{n-1}}{n} \frac{(z-z_0)^n}{z_0^n} + ... \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_66.png">
</p>
<p>where we have obtained the derivarives from (ln(z))' = 1/z and the power rule applied to complex functions </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} f(z) &amp;=&amp; ln(z) \quad \quad \implies f(z_0) = ln(z_0) \\ f&#39;(z) &amp;=&amp; \frac{1}{z} = \frac{(-1)^0 0!}{z^1} \quad \implies f&#39;(z_0) = \frac{1}{z_0} \\ f&#39;&#39;(z) &amp;=&amp; \frac{(-1)^1 1!}{z^2} \quad \quad \implies f&#39;&#39;(z_0) = \frac{(-1)^1 1!}{z_0^2} \\ f&#39;&#39;&#39;(z) &amp;=&amp; \frac{(-1)^2 2!}{z^3} \quad \quad \implies f&#39;&#39;&#39;(z_0) = \frac{(-1)^2 2!}{z_0^3} \\ f^{(4)}(z) &amp;=&amp; \frac{(-1)^3 3!}{z^4} \quad \quad \implies f^{(4)}(z_0) = \frac{(-1)^3 3!}{z_0^4} \\ &amp;...&amp; \\ f^{(n)}(z) &amp;=&amp; \frac{(-1)^{n-1} (n-1)!}{z^n} \quad \implies f^{(n)}(z_0) = \frac{(-1)^{n-1} (n-1)!}{z_0^n} \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_67.png">
</p>
<p>From the Ratio Test, we know that the series above <img class="formulaInl" alt="$\sum_{n=0}^{\infty} a_n$" src="./FMM_2D_ Main_Page_files/form_68.png"> will converge (absolutely) if </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ lim_{n \to \infty} \| \frac{a_{n+1}}{a_{n}} \| = \lim_{n \to \infty} \| \frac{n+1}{n} \frac{z-z_0}{z_0} \| &lt; 1 \implies \frac{\|z-z_0\|}{\|z_0\|} &lt; 1 \]" src="./FMM_2D_ Main_Page_files/form_69.png">
</p>
<p>If we take <img class="formulaInl" alt="$z = y - x_i$" src="./FMM_2D_ Main_Page_files/form_70.png"> and <img class="formulaInl" alt="$z_0 = y - x_*$" src="./FMM_2D_ Main_Page_files/form_71.png">, then <img class="formulaInl" alt="$z - z_0 = x_* - x_i$" src="./FMM_2D_ Main_Page_files/form_72.png"> and the Taylor series </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ f(z) = ln(z_0) + \sum_{n=1}^{\infty} \frac{ (-1)^{n-1} }{ n } \frac{(z - z_0)^n}{z_0^n} \]" src="./FMM_2D_ Main_Page_files/form_73.png">
</p>
<p> becomes (where we have changed the letter of the index from <img class="formulaInl" alt="$n$" src="./FMM_2D_ Main_Page_files/form_74.png"> to <img class="formulaInl" alt="$m$" src="./FMM_2D_ Main_Page_files/form_75.png"> to correspond with <a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/citelist.html#CITEREF_wang2005">[2]</a>) </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} f(y - x_i) &amp;=&amp; ln(y - x_*) + \sum_{n=1}^{\infty} \frac{ (-1)^{n-1} }{ n } \frac{(x_* - x_i)^n}{(y - x_*)^n} \\ &amp;=&amp; ln(y - x_*) + \sum_{m=1}^{\infty} \frac{ (-1)^{m-1} * (-1)^{m} }{ m } \frac{(x_i - x_*)^m}{(y - x_*)^m} \\ &amp;=&amp; ln(y - x_*) + \sum_{m=1}^{\infty} \frac{-1}{m} \frac{(x_i-x_*)^m}{(y-x_*)^m} \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_76.png">
</p>
<p>The Ratio Test implies that </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[\frac{ \|z - z_0\| }{ \|z_0\| } = \frac{ \|x_i - x_*\| }{ \|y - x_*\| } &lt; 1. \]" src="./FMM_2D_ Main_Page_files/form_77.png">
</p>
<p> That is <img class="formulaInl" alt="$\|x_i - x_*\| &lt; \|y - x_*\|$" src="./FMM_2D_ Main_Page_files/form_78.png">. Geomtrically, this means the distance between <img class="formulaInl" alt="$y$" src="./FMM_2D_ Main_Page_files/form_79.png"> and <img class="formulaInl" alt="$x_*$" src="./FMM_2D_ Main_Page_files/form_80.png"> must be greater than <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> and <img class="formulaInl" alt="$x_*$" src="./FMM_2D_ Main_Page_files/form_80.png">, or that <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> must live inside the disc with center <img class="formulaInl" alt="$x_*$" src="./FMM_2D_ Main_Page_files/form_80.png"> and radius <img class="formulaInl" alt="$\|y - x_*\|$" src="./FMM_2D_ Main_Page_files/form_81.png">.</p>
<p>If instead we let <img class="formulaInl" alt="$z = y - x_i$" src="./FMM_2D_ Main_Page_files/form_70.png"> and <img class="formulaInl" alt="$z_0 = x_* - x_i$" src="./FMM_2D_ Main_Page_files/form_82.png">, then <img class="formulaInl" alt="$z - z_0 = y - x_*$" src="./FMM_2D_ Main_Page_files/form_83.png"> and </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} f(z) &amp;=&amp; ln(z_0) + \sum_{n=1}^{\infty} \frac{ (-1)^{n-1} }{ n } \frac{(z - z_0)^n}{z_0^n} \\ f(y-x_i) &amp;=&amp; ln(x_*-x_i) + \sum_{n=1}^{\infty} \frac{(-1)^{n-1}}{n} \frac{(y-x_*)^n}{(x_*-x_i)^n} \\ &amp;=&amp; ln(x_*-x_i) + \sum_{m=1}^{\infty} \frac{-1}{m} \frac{(y-x_*)^m}{(x_i-x_*)^m} \\ \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_84.png">
</p>
<p>The series converges absolutely if <img class="formulaInl" alt="$\lim_{n \to \infty} \| \frac{a_n+1}{a_n} \| = \| \frac{y-x_*}{x_i-x_*} \| &lt; 1$" src="./FMM_2D_ Main_Page_files/form_85.png">. That is, </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \|y-x_*\| &lt; \|x_i-x_*\|. \]" src="./FMM_2D_ Main_Page_files/form_86.png">
</p>
<p> Therefore, for convergence, it is necessary that <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> live outside the disc with center <img class="formulaInl" alt="$x_*$" src="./FMM_2D_ Main_Page_files/form_80.png"> and radius <img class="formulaInl" alt="$\|y - x_*\|$" src="./FMM_2D_ Main_Page_files/form_81.png"></p>
<h2><a class="anchor" id="field_expansion_subsection"></a>
S and R Expansions</h2>
<p>Far-Field and Near-Field Expansions</p>
<div class="image">
<img src="./FMM_2D_ Main_Page_files/fields3.png" alt="fields3.png">
</div>
<h3><a class="anchor" id="far_field_expansion_subsubsection"></a>
S-Expansion (Far-Field Expansion)</h3>
<p>We call the first Taylor series expansion shown above </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \ln(y-x_i) &amp;=&amp; \ln(y-x_*) + \sum_{m=1}^{\infty} \frac{-1}{m} \frac{(x_i-x_*)^m}{(y-x_*)^m} \\ &amp;=&amp; \sum_{m=0}^{\infty} b_m(x_i,x_*) S_m(y-x_*) \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_87.png">
</p>
<p> the S-expansion or far-field expansion, where </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} b_m(x_i,x_*) &amp;=&amp; \left\{ \begin{matrix} 1 &amp; \mbox{if} &amp; m = 0 \\ \frac{-1}{m} (x_i-x_*)^m &amp; \mbox{if} &amp; m \geq 1 \end{matrix} \right. \\ S_m(y-x_*) &amp;=&amp; \left\{ \begin{matrix} \ln(y-x_*) &amp; \mbox{if} &amp; m = 0 \\ \frac{1}{(y-x_*)^m} &amp; \mbox{if} &amp; m \geq 1 \end{matrix} \right. \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_88.png">
</p>
<p>Indeed, from the Ratio Test we have seen that the Taylor series converges if <img class="formulaInl" alt="$y$" src="./FMM_2D_ Main_Page_files/form_79.png"> is outside (or far from ) the disc of radius <img class="formulaInl" alt="$R_* = \|x_i-x_*\|$" src="./FMM_2D_ Main_Page_files/form_89.png"> centered at <img class="formulaInl" alt="$x_*$" src="./FMM_2D_ Main_Page_files/form_80.png">.</p>
<h3><a class="anchor" id="near_field_expansion_subsubsection"></a>
R-Expansion (Near-Field Expansion)</h3>
<p>We call the second Taylor series expansion above </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \ln(y-x_i) &amp;=&amp; \ln(x_*-x_i) + \sum_{m=1}^{\infty} \frac{-1}{m} \frac{(y-x_*)^m}{(x_i-x_*)^m} \\ &amp;=&amp; \sum_{m=0}^{\infty} a_m(x_i,x_*) R_m(y-x_*) \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_90.png">
</p>
<p> the R-expansion or near-field expansion (or local expansion), where </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} a_m(x_i,x_*) &amp;=&amp; \left\{ \begin{matrix} \ln(x_*-x_i) &amp; \mbox{if} &amp; m = 0 \\ \frac{-1}{m (x_i-x_*)^m} &amp; \mbox{if} &amp; m \geq 1 \end{matrix} \right. \\ R_m(y-x_*) &amp;=&amp; \left\{ \begin{matrix} 1 &amp; \mbox{if} &amp; m = 0 \\ (y-x_*)^m &amp; \mbox{if} &amp; m \geq 1 \end{matrix} \right. \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_93.png">
</p>
<p>And, from the Ratio Test we have seen that the Taylor series converges if <img class="formulaInl" alt="$y$" src="./FMM_2D_ Main_Page_files/form_79.png"> lives inside (near or local to) the disc of radius <img class="formulaInl" alt="$r_* = \|x_i-x_*\|$" src="./FMM_2D_ Main_Page_files/form_92.png"> centered at <img class="formulaInl" alt="$x_*$" src="./FMM_2D_ Main_Page_files/form_80.png">.</p>
<h2><a class="anchor" id="translation_subsection"></a>
Translations</h2>
<h3><a class="anchor" id="local_to_local_translation_subsubsection"></a>
(R|R) Translation (local-to-local translation)</h3>
<p>Let <img class="formulaInl" alt="$z = y-x_*$" src="./FMM_2D_ Main_Page_files/form_94.png"> and consider the function <img class="formulaInl" alt="$f(z) = z^m$" src="./FMM_2D_ Main_Page_files/form_95.png">. We wish to write the function <img class="formulaInl" alt="$f(z+t) = (z+t)^m$" src="./FMM_2D_ Main_Page_files/form_96.png"> as a Taylor series expansion about <img class="formulaInl" alt="$t = 0$" src="./FMM_2D_ Main_Page_files/form_97.png">. Let <img class="formulaInl" alt="$\tilde{t} = z+t$" src="./FMM_2D_ Main_Page_files/form_111.png"> be our complex variable. Then the function we wish to expand is </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ f(\tilde{t}) = (\tilde{t})^m = (z+t)^m = f(z+t) \]" src="./FMM_2D_ Main_Page_files/form_106.png">
</p>
<p> about <img class="formulaInl" alt="$\tilde{t} = z$" src="./FMM_2D_ Main_Page_files/form_103.png">. Using the chain rule and the power rule for complex functions on </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \frac{d}{d \tilde{t}} f(\tilde{t}) &amp;=&amp; f&#39;(\tilde{t}) = m(\tilde{t})^{m-1} = \frac{m!}{(m-1)!} (\tilde{t})^{m-1} \implies \quad \frac{df}{d\tilde{t}} \big|_{\tilde{t}=z} = \frac{m!}{(m-1)!} z^{m-1} \\ \frac{d^2}{dt^2} f(\tilde{t}) &amp;=&amp; f&#39;&#39;(z+t) = m(m-1)(\tilde{t})^{m-2} = \frac{m!}{(m-2)!} (\tilde{t})^{m-2} \quad \implies \quad \frac{d^2f}{d \tilde{t}^2} \big|_{\tilde{t}=z} = \frac{m!}{(m-2)!} z^{m-2} \\ f&#39;&#39;&#39;(\tilde{t}) &amp;=&amp; m(m-1)(m-2)(\tilde{t})^{m-3} = \frac{m!}{(m-3)!} (\tilde{t})^{m-3} \quad \implies \quad f&#39;&#39;&#39;(z) = \frac{m!}{(m-3)!} z^{m-3} \\ f^{(4)}(\tilde{t}) &amp;=&amp; m(m-1)(m-2)(m-3)(\tilde{t})^{m-4} = \frac{m!}{(m-4)!} (\tilde{t})^{m-4} \quad \implies \quad f^{(4)}(z) = \frac{m!}{(m-4)!} z^{m-4} \\ &amp; ... &amp; \\ f^{(m-2)}(\tilde{t}) &amp;=&amp; \frac{m!}{(m-(m-2))!} (\tilde{t})^{m-(m-2)} = \frac{m!}{2!} (\tilde{t})^{2} \quad \implies \quad f^{(m-2)}(z) = \frac{m!}{2!} z^2 \\ f^{(m-1)}(\tilde{t}) &amp;=&amp; \frac{m!}{(m-(m-1))!} (\tilde{t})^{m-(m-1)} = \frac{m!}{1!} (\tilde{t})^{1} \quad \implies \quad f^{(m-1)}(z) = \frac{m!}{1!} z^1 = m! z \\ f^{(m)}(\tilde{t}) &amp;=&amp; \frac{m!}{(m-m)!} (\tilde{t})^(m-m) = \frac{m!}{0!} (\tilde{t})^0 = m! \quad \implies \quad f^{(m)}(z) = m! \\ f^{(m+1)}(\tilde{t}) &amp;=&amp; \frac{d}{dt} m! = 0 \quad \implies \quad f^{(m+1)}(z) = 0 \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_604.png">
</p>
<p>Therefore, the expansion is </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ (y-(x_*-t))^m = (y-x_*+t)^m = (z+t)^m = (\tilde{t})^m = f(\tilde{t}) = \sum_{n=0}^{\infty} \frac{f^{(n)}(z)}{n!} (\tilde{t} - z)^n = \sum_{n=0}^{m} \frac{m!}{(m-n)!n!} z^{m-n} t^n = \sum_{n=0}^{m} \begin{pmatrix} m \\ n \end{pmatrix} z^{m-n} t^n \]" src="./FMM_2D_ Main_Page_files/form_110.png">
</p>
<p>Letting the expansion being centered at <img class="formulaInl" alt="$t$" src="./FMM_2D_ Main_Page_files/form_164.png"> and noting that <img class="formulaInl" alt="$\tilde{t}-t = z$" src="./FMM_2D_ Main_Page_files/form_165.png">, then <img class="formulaInl" alt="$(y-(x_*-t))^m$" src="./FMM_2D_ Main_Page_files/form_170.png"> can be written as </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ (y-(x_*-t))^m = \sum_{n=0}^{m} t^{m-n} z^n = \sum_{n=0}^{m} (y-x_*)^n t^{m-n} \]" src="./FMM_2D_ Main_Page_files/form_167.png">
</p>
<p>Note <img class="formulaInl" alt="$R_m(y-x_*+t) = (y-x_*+t)^m$" src="./FMM_2D_ Main_Page_files/form_168.png">. Therefore, </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} R_0(y-x_*+t) &amp; = &amp; \sum_{n=0}^{0} \begin{pmatrix} 0 \\ n \end{pmatrix} (y - x_*)^n t^{m-n} = 1 = R_0(y-x_*) \\ R_1(y-x_*+t) &amp; = &amp; \sum_{n=0}^{1} \begin{pmatrix} 1 \\ n \end{pmatrix} (y-x_*)^n t^{m-n} = \begin{pmatrix} 1 \\ 0 \end{pmatrix} (y-x_*)^0 t^1 + \begin{pmatrix} 1 \\ 1 \end{pmatrix} (y-x_*)^1 t^0 \\ &amp; = &amp; t + (y-x_*) \\ &amp; = &amp; tR_0(y-x_*) + R_1(y-x_*) \\ R_2(y-x_*+t) &amp; = &amp; \sum_{n=0}^{2} \begin{pmatrix} 2 \\ n \end{pmatrix} (y - x_*)^n t^{m-n} \\ &amp; = &amp; \begin{pmatrix} 2 \\ 0 \end{pmatrix} (y-x_*)^0 t^2 + \begin{pmatrix} 2 \\ 1 \end{pmatrix} (y-x_*)^1 t^1 + \begin{pmatrix} 2 \\ 2 \end{pmatrix} (y-x_*)^2 t^0 \\ &amp; = &amp; t^2 + 2(y-x_*)t + (y-x_*)^2 \\ &amp; = &amp; t^2R_0(y-x_*) + 2tR_1(y-x_*) + R_2(y-x_*) \\ R_3(y-x_*+t) &amp; = &amp; \sum_{n=0}^{3} \begin{pmatrix} 3 \\ n \end{pmatrix} (y - x_*)^n t^{m-n} \\ &amp; = &amp; \begin{pmatrix} 3 \\ 0 \end{pmatrix} (y-x_*)^0 t^3 + \begin{pmatrix} 3 \\ 1 \end{pmatrix} (y-x_*)^1 t^2 + \begin{pmatrix} 3 \\ 2 \end{pmatrix} (y-x_*)^2 t^1 + \begin{pmatrix} 3 \\ 3 \end{pmatrix} (y-x_*)^3 t^0 \\ &amp; = &amp; t^3 + 3(y-x_*)t^2 + 3(y-x_*)^2t + (y-x_*)^3 \\ &amp; = &amp; t^3R_0(y-x_*) + 3t^2R_1(y-x_*) + 3tR_2(y-x_*) + R_3(y-x_*) \\ R_4(y-x_*+t) &amp; = &amp; \sum_{n=0}^{4} \begin{pmatrix} 4 \\ n \end{pmatrix} (y - x_*)^n t^{m-n} \\ &amp; = &amp; \begin{pmatrix} 4 \\ 0 \end{pmatrix} (y-x_*)^0 t^4 + \begin{pmatrix} 4 \\ 1 \end{pmatrix} (y-x_*)^1 t^3 + \begin{pmatrix} 4 \\ 2 \end{pmatrix} (y-x_*)^2 t^2 + \begin{pmatrix} 4 \\ 3 \end{pmatrix} (y-x_*)^3 t^1 + \begin{pmatrix} 4 \\ 4 \end{pmatrix} (y-x_*)^4 t^0 \\ &amp; = &amp; t^4 + 4(y-x_*)t^3 + 6(y-x_*)^2t^2 + 4(y-x_*)^3t + (y-x_*)^4 \\ &amp; = &amp; t^4R_0(y-x_*) + 4t^3R_1(y-x_*) + 6t^2R_2(y-x_*) + 4tR_3(y-x_*) + R_4(y-x_*) \\ R_5(y-x_*+t) &amp; = &amp; \sum_{n=0}^{5} \begin{pmatrix} 5 \\ n \end{pmatrix} (y - x_*)^n t^{m-n} \\ &amp; = &amp; \begin{pmatrix} 5 \\ 0 \end{pmatrix} (y-x_*)^0 t^5 + \begin{pmatrix} 5 \\ 1 \end{pmatrix} (y-x_*)^1 t^4 + \begin{pmatrix} 5 \\ 2 \end{pmatrix} (y-x_*)^2 t^3 + \begin{pmatrix} 5 \\ 3 \end{pmatrix} (y-x_*)^3 t^2 + \begin{pmatrix} 5 \\ 4 \end{pmatrix} (y-x_*)^4 t^1 + \begin{pmatrix} 5 \\ 5 \end{pmatrix} (y-x_*)^5 t^0 \\ &amp; = &amp; t^5 + 5(y-x_*)t^4 + 10(y-x_*)^2t^3 + 10(y-x_*)^3t^2 + 5(y-x_*)^4t + (y-x_*)^5 \\ &amp; = &amp; t^5R_0(y-x_*) + 5t^4R_1(y-x_*) + 10t^3R_2(y-x_*) + 10t^2R_3(y-x_*) + 5tR_4(y-x_*) + R_5(y-x_*) \\ &amp; \vdots &amp; \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_176.png">
</p>
<p>As a transformation, this results in an infinite matrix</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{bmatrix} R_0(y-x_*+t) \\ R_1(y-x_*+t) \\ R_2(y-x_*+t) \\ R_3(y-x_*+t) \\ R_4(y-x_*+t) \\ R_5(y-x_*+t) \\ R_6(y-x_*+t) \\ \vdots \end{bmatrix} = \begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \hdots &amp; 0 &amp; \hdots \\ t &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \hdots &amp; 0 &amp; \hdots \\ t^2 &amp; 2t &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \hdots &amp; 0 &amp; \hdots \\ t^3 &amp; 3t^2 &amp; 3t &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; \hdots &amp; 0 &amp; \hdots \\ t^4 &amp; 4t^3 &amp; 6t^2 &amp; 4t &amp; 1 &amp; 0 &amp; 0 &amp; \hdots &amp; 0 &amp; \hdots \\ t^5 &amp; 5t^4 &amp; 10t^3 &amp; 10t^2 &amp; 5t &amp; 1 &amp; 0 &amp; \hdots &amp; 0 &amp; \hdots \\ \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \ddots &amp; \ddots &amp; \vdots &amp; \vdots \\ \end{bmatrix} \begin{bmatrix} R_0(y-x_*) \\ R_1(y-x_*) \\ R_2(y-x_*) \\ R_3(y-x_*) \\ R_4(y-x_*) \\ R_5(y-x_*) \\ R_6(y-x_*) \\ \vdots \end{bmatrix} \]" src="./FMM_2D_ Main_Page_files/form_307.png">
</p>
<p>To obtain the formula for the translation from the center <img class="formulaInl" alt="$x_*-t$" src="./FMM_2D_ Main_Page_files/form_326.png"> to <img class="formulaInl" alt="$x_*$" src="./FMM_2D_ Main_Page_files/form_80.png">, we multiply each equation by its corresponding coefficient <img class="formulaInl" alt="$a_m(x_i,x_*-t)$" src="./FMM_2D_ Main_Page_files/form_327.png"> and sum the equations. The left-hand side is the Taylor series expansion at <img class="formulaInl" alt="$(x_*-t)$" src="./FMM_2D_ Main_Page_files/form_328.png"> </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \sum_{m=0}^{\infty} a_m(x_i,x_*-t) R_m(y-x_*+t) \]" src="./FMM_2D_ Main_Page_files/form_329.png">
</p>
<p> and the right-hand side is the formula for the translation</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \sum_{m=0}^{\infty} a_m(x_i,x_*-t) R_m(y-x_*+t) &amp; = &amp; \sum_{k=0}^{\infty} a_k(x_i,x_*-t) \begin{pmatrix} k \\ 0 \end{pmatrix} t^k R_0(y-x_*) + \sum_{k=1}^{\infty} a_{k}(x_i,x_*-t) \begin{pmatrix} k \\ 1 \end{pmatrix} t^{k-1} R_1(y-x_*) \\ &amp;&amp; + \sum_{k=2}^{\infty} a_{k}(x_i,x_*-t) \begin{pmatrix} k \\ 2 \end{pmatrix} t^{k-2} R_2(y-x_*) + \sum_{k=3}^{\infty} a_{k}(x_i,x_*-t) \begin{pmatrix} k \\ 3 \end{pmatrix} t^{k-3} R_3(y-x_*) \\ &amp;&amp; + \hdots + \sum_{k=l-1}^{\infty} a_{k}(x_i,x_*-t) \begin{pmatrix} k \\ l-1 \end{pmatrix} t^{k-(l-1)} R_{l-1}(y-x_*) + \sum_{k=l}^{\infty} a_{k}(x_i,x_*-t) \begin{pmatrix} k \\ l \end{pmatrix} t^{k-l} R_l(y-x_*) + \hdots \\ &amp; = &amp; \sum_{m=0}^{\infty} \left( \sum_{k=m}^{\infty} a_k(x_i,x_*-t) \begin{pmatrix} k \\ m \end{pmatrix} t^{k-m} \right) R_m(y-x_*) \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_331.png">
</p>
<p>Therefore, we have the formula for the translation </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \sum_{m=0}^{\infty} a_m(x_i,x_*-t) R_m(y-x_*+t) = \sum_{m=0}^{\infty} a_m(x_i,x_*) R_m(y-x_*) \]" src="./FMM_2D_ Main_Page_files/form_333.png">
</p>
<p> where </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ a_m(x_i,x_*) = \sum_{k=m}^{\infty} a_k(x_i,x_*-t) \begin{pmatrix} k \\ m \end{pmatrix} t^{k-m} \]" src="./FMM_2D_ Main_Page_files/form_332.png">
</p>
<p><b> Approximation </b></p>
<p>We will appproximate the RR-translation by truncating the series to <img class="formulaInl" alt="$p$" src="./FMM_2D_ Main_Page_files/form_543.png"> terms. This results in a <img class="formulaInl" alt="$p$" src="./FMM_2D_ Main_Page_files/form_543.png">-by- <img class="formulaInl" alt="$p$" src="./FMM_2D_ Main_Page_files/form_543.png"> translation matrix. Note that the indexing for <img class="formulaInl" alt="$p$" src="./FMM_2D_ Main_Page_files/form_543.png"> starts on one.</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \hdots &amp; 0 \\ t &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \hdots &amp; 0 \\ t^2 &amp; 2t &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; \hdots &amp; 0 \\ t^3 &amp; 3t^2 &amp; 3t &amp; 1 &amp; 0 &amp; 0 &amp; \hdots &amp; 0 \\ t^4 &amp; 4t^3 &amp; 6t^2 &amp; 4t &amp; 1 &amp; 0 &amp; \hdots &amp; 0 \\ t^5 &amp; 5t^4 &amp; 10t^3 &amp; 10t^2 &amp; 5t &amp; 1 &amp; \ddots &amp; \vdots \\ \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \ddots &amp; 0 \\ t^{p-1} &amp; \begin{pmatrix} p-1 \\ 1 \end{pmatrix} t^{p-2} &amp; \begin{pmatrix} p-1 \\ 2 \end{pmatrix} t^{p-3} &amp; \begin{pmatrix} p-1 \\ 3 \end{pmatrix} t^{p-4} &amp; \begin{pmatrix} p-1 \\ 4 \end{pmatrix} t^{p-5} &amp; \hdots &amp; \begin{pmatrix} p-1 \\ p-2 \end{pmatrix} t^{p-(p-1)} &amp; 1 \end{bmatrix} \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_603.png">
</p>
<p>We work with the transpose of this approximation in the code (getRR member function in Potential.cc).</p>
<h3><a class="anchor" id="far_to_near_translation_subsubsection"></a>
(S|R) Translation (far-to-near translation)</h3>
<p>Recall the Far-Field Expansion </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \ln(y-x_i) &amp;=&amp; ln(y-x_*) + \sum_{m=1}^{\infty} \frac{-1}{m} \frac{(x_i-x_*)^m}{(y-x_*)^m} \\ &amp; = &amp; \sum_{m=0}^{\infty} b_m(x_i,x_*) S_m(y-x_*) \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_183.png">
</p>
<p>Let <img class="formulaInl" alt="$z = y-x_*$" src="./FMM_2D_ Main_Page_files/form_94.png"> and consider the function <img class="formulaInl" alt="$f(z) = \frac{1}{z^m} $" src="./FMM_2D_ Main_Page_files/form_184.png">. Let <img class="formulaInl" alt="$\tilde{t} = z+t$" src="./FMM_2D_ Main_Page_files/form_111.png"> and <img class="formulaInl" alt="$k = -m$" src="./FMM_2D_ Main_Page_files/form_200.png">, then </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ f(\tilde{t}) = (\tilde{t})^k = (z+t)^{-m} = f(z+t). \]" src="./FMM_2D_ Main_Page_files/form_334.png">
</p>
<p> We wish to determine the Taylor series centered at <img class="formulaInl" alt="$\tilde{t} = z$" src="./FMM_2D_ Main_Page_files/form_103.png">. Using the chain rule and the power rule for complex functions on</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} f (\tilde{t}) &amp;=&amp; \tilde{t}^{-m} \quad \implies \quad f(z) = z^{-m} \\ f&#39; (\tilde{t}) &amp;=&amp; -m \tilde{t}^{-m-1} = -m \tilde{t}^{-m-1} \quad \implies \quad f&#39;(z) = -m z^{-m-1} \\ f&#39;&#39; (\tilde{t}) &amp;=&amp; -m(-m-1) \tilde{t}^{-m-2} = -m(-m-1) \tilde{t}^{-m-2} = \frac{(-m)!}{(-m-2)!} \tilde{t}^{-m-2} \quad \implies \quad f&#39;&#39;(z) = \frac{(-m)!}{(-m-2)!} z^{-m-2} \\ f&#39;&#39;&#39;(\tilde{t}) &amp;=&amp; -m(-m-1)(-m-2) \tilde{t}^{-m-3} = \frac{(-m)!}{(-m-3)!} \tilde{t}^{-m-3} \quad \implies \quad f&#39;&#39;&#39;(z) = \frac{(-m)!}{(-m-3)!} z^{-m-3} = \\ f^{(4)} (\tilde{t}) &amp; = &amp; -m(-m-1)(-m-2)(-m-3) \tilde{t}^{-m-4} = \frac{(-m)!}{(-m-4)!} z^{-m-4} \quad \implies \quad f^{(4)}(z) = (-1)^4 \frac{(-m)!}{(-m-4)!} z^{-m-4} \\ f^{(5)} (\tilde{t}) &amp; = &amp; -m(-m-1)(-m-2)(-m-3)(-m-4) \tilde{t}^{-(m+5)} = (-1)^5 \frac{(-m)!}{(-m-5)!} \tilde{t}^{-m-5} \quad \implies \quad f^{(5)}(z) = \frac{(-m)!}{(-m-5)!} z^{-m-5} \\ &amp; \vdots &amp; \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_335.png">
</p>
<p>Realizing that we are dealing with a binomial series (a special Taylor series), let <img class="formulaInl" alt="$k = -m$" src="./FMM_2D_ Main_Page_files/form_200.png"> and write the expansion as</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \frac{1}{\tilde{t}^m} = \tilde{t}^k = f(\tilde{t}) &amp; = &amp; \sum_{n=0}^{\infty} \frac{f^{(n)}(z)}{n!} (\tilde{t} - z)^n = \sum_{n=0}^{\infty} \frac{k!}{(k-n)!n!} z^{k-n}t^n = \sum_{n=0}^{\infty} \begin{pmatrix} k \\ n \end{pmatrix} z^{k-n} t^n = \sum_{n=0}^{\infty} \begin{pmatrix} -m \\ n \end{pmatrix} z^{-m-n} t^n \\ &amp; = &amp; \sum_{n=0}^{\infty} \begin{pmatrix} -m \\ n \end{pmatrix} z^n t^{-m-n} \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_208.png">
</p>
<p>where the last equality results from the center of the expansion around <img class="formulaInl" alt="$t$" src="./FMM_2D_ Main_Page_files/form_164.png"> where <img class="formulaInl" alt="$\tilde{t}-t = z$" src="./FMM_2D_ Main_Page_files/form_165.png">. We use the combination notation loosely in the sense that factorials of negative integers are not formally defined here. However, the notation is the same as that used for the binomial series </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{pmatrix} -m \\ n \end{pmatrix} \colon = \frac{(-m)(-m-1)(-m-2)\hdots(-m-n)}{n!} \quad \left( =: \frac{(-m)!}{(-m-n)!n!} \right) \]" src="./FMM_2D_ Main_Page_files/form_336.png">
</p>
<p> Recall </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ S_m(y-x_*) = \left\{ \begin{matrix} \ln(y-x_*) &amp; \mbox{if} &amp; m = 0 \\ \frac{1}{(y-x_*)^m} &amp; \mbox{if} &amp; m \geq 1 \end{matrix} \right. \]" src="./FMM_2D_ Main_Page_files/form_207.png">
</p>
<p>With <img class="formulaInl" alt="$S_m(y-x_*+t)$" src="./FMM_2D_ Main_Page_files/form_209.png"> defined in the same manner (recalling <img class="formulaInl" alt="$z = y-x_*$" src="./FMM_2D_ Main_Page_files/form_94.png"> and doing the Taylor series for the case <img class="formulaInl" alt="$S_0(y-x_*+t)$" src="./FMM_2D_ Main_Page_files/form_291.png"> on the fly) </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} S_0(y-x_*+t) &amp;=&amp; \ln(y-x_*+t) = \ln(t) + \frac{1}{t} z - \frac{1}{2t^2} z^2 + \frac{1}{3t^3} z^3 - \frac{1}{4t^4} z^4 + + \hdots + \frac{(-1)^n}{nt^n}z^n + \hdots \\ &amp;=&amp; \ln(t) R_0(y-x_*) + \frac{1}{t} R_1(y-x_*) - \frac{1}{2t^2} R_2(y-x_*) + + \frac{1}{3t^3} R_3(y-x_*) - \frac{1}{4t^4} R_4(y-x_*) + \hdots + \frac{(-1)^n}{4t^n} R_n(y-x_*) + \hdots \\ S_1(y-x_*+t) &amp;=&amp; \frac{1}{y-x_*+t} = \sum_{n=0}^{\infty} \begin{pmatrix} -1 \\ n \end{pmatrix} (y-x_*)^n t^{-1-n} = \sum_{n=0}^{\infty} \begin{pmatrix} -1 \\ n \end{pmatrix} R_n(y-x_*) t^{-1-n} \\ &amp; = &amp; \begin{pmatrix} -1 \\ 0 \end{pmatrix} R_0(y-x_*) t^{-1-0} + \begin{pmatrix} -1 \\ 1 \end{pmatrix} R_1(y-x_*) t^{-1-1} + \begin{pmatrix} -1 \\ 2 \end{pmatrix} R_2(y-x_*) t^{-1-2} + \hdots + \begin{pmatrix} -1 \\ n \end{pmatrix} R_n(y-x_*) t^{-1-n} + \hdots \\ &amp; = &amp; \frac{(-1)!}{(-1-0)!0!} R_0(y-x^*) t^{-1-0} + \frac{(-1)!}{(-1-1)!1!} R_1(y-x_*)t^{-1-1} + \frac{(-1)!}{(-1-2)!2!} R_2(y-x_*)t^{-1-2} + \hdots + \frac{(-1)!}{(-1-n)!n!} R_n(y-x_*)t^{-1-n} + \hdots \\ &amp; = &amp; R_0(y-x_*) t^{-1} + \frac{(-1)(-2)!}{(-2)!1!} R_1(y-x_*)t^{-2} + + \frac{(-1)(-2)(-3)!}{(-3)!2!} R_2(y-x_*)t^{-3} + + \frac{(-1)(-2)(-3)(-4)!}{(-4)!3!} R_3(y-x_*)t^{-4} \\ &amp;&amp; + \frac{(-1)(-2)(-3)(-4)(-5)!}{(-5)!4!} R_4(y-x_*)t^{-5} + \hdots + \frac{(-1)(-2)\hdots(-n)(-1-n)!}{(-1-n)!n!} R_n(y-x_*)t^{-1-n} + \hdots \\ &amp; = &amp; R_0(y-x_*) t^{-1} - R_1(y-x_*)t^{-2} + R_2(y-x_*)t^{-3} - R_3(y-x_*)t^{-4} + R_4(y-x_*)t^{-5} + \hdots + (-1)^{n}R_n(y-x_*)t^{-1-n} + \hdots \\ S_2(y-x_*+t) &amp;=&amp; \frac{1}{(y-x_*+t)^2} = \sum_{n=0}^{\infty} \begin{pmatrix} -2 \\ n \end{pmatrix} (y-x_*)^n t^{-2-n} = \sum_{n=0}^{\infty} \begin{pmatrix} -2 \\ n \end{pmatrix} R_n(y-x_*) t^{-2-n} \\ &amp; = &amp; \begin{pmatrix} -2 \\ 0 \end{pmatrix} R_0(y-x_*) t^{-2-0} + \begin{pmatrix} -2 \\ 1 \end{pmatrix} R_1(y-x_*) t^{-2-1} + \begin{pmatrix} -2 \\ 2 \end{pmatrix} R_2(y-x_*) t^{-2-2} + \hdots + \begin{pmatrix} -2 \\ n \end{pmatrix} R_n(y-x_*) t^{-2-n} + \hdots \\ &amp; = &amp; \frac{(-2)!}{(-2-0)!0!} R_0(y-x^*) t^{-2-0} + \frac{(-2)!}{(-2-1)!1!} R_2(y-x_*)t^{-2-1} + \frac{(-2)!}{(-2-2)!2!} R_2(y-x_*)t^{-2-2} + \hdots + \frac{(-1)!}{(-1-n)!n!} R_n(y-x_*)t^{-1-n} + \hdots \\ &amp; = &amp; R_0(y-x_*) t^{-2} + \frac{(-2)(-3)!}{(-3)!1!} R_1(y-x_*)t^{-3} + + \frac{(-2)(-3)(-4)!}{(-4)!2!} R_2(y-x_*)t^{-4} + + \frac{(-2)(-3)(-4)(-5)!}{(-5)!3!} R_3(y-x_*)t^{-5} \\ &amp;&amp; + \frac{(-2)(-3)(-4)(-5)(-6)!}{(-6)!4!} R_4(y-x_*)t^{-6} + \hdots + \frac{(-2)(-3)\hdots(-1-n)(-2-n)!}{(-2-n)!n!} R_n(y-x_*)t^{-1-n} + \hdots \\ &amp; = &amp; R_0(y-x_*) t^{-2} - 2R_1(y-x_*)t^{-3} + 3R_2(y-x_*)t^{-4} - 4R_3(y-x_*)t^{-5} + 5R_4(y-x_*)t^{-6} + \hdots + (-1)^{n}(n+1)R_n(y-x_*)t^{-2-n} + \hdots \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_293.png">
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} S_3(y-x_*+t) &amp;=&amp; \frac{1}{(y-x_*+t)^3} = \sum_{n=0}^{\infty} \begin{pmatrix} -3 \\ n \end{pmatrix} (y-x_*)^n t^{-3-n} = \sum_{n=0}^{\infty} \begin{pmatrix} -3 \\ n \end{pmatrix} R_n(y-x_*) t^{-3-n} \\ &amp; = &amp; \begin{pmatrix} -3 \\ 0 \end{pmatrix} R_0(y-x_*) t^{-2-0} + \begin{pmatrix} -3 \\ 1 \end{pmatrix} R_1(y-x_*) t^{-2-1} + \begin{pmatrix} -3 \\ 2 \end{pmatrix} R_2(y-x_*) t^{-2-2} + \hdots + \begin{pmatrix} -3 \\ n \end{pmatrix} R_n(y-x_*) t^{-2-n} + \hdots \\ &amp; = &amp; \frac{(-3)!}{(-3-0)!0!} R_0(y-x^*) t^{-3-0} + \frac{(-3)!}{(-3-1)!1!} R_2(y-x_*)t^{-3-1} + \frac{(-3)!}{(-3-2)!2!} R_2(y-x_*)t^{-3-2} + \hdots + \frac{(-3)!}{(-3-n)!n!} R_n(y-x_*)t^{-3-n} + \hdots \\ &amp; = &amp; R_0(y-x_*) t^{-3} + \frac{(-3)(-4)!}{(-4)!1!} R_1(y-x_*)t^{-4} + + \frac{(-3)(-4)(-5)!}{(-5)!2!} R_2(y-x_*)t^{-5} + + \frac{(-3)(-4)(-5)(-6)!}{(-6)!3!} R_3(y-x_*)t^{-6} \\ &amp;&amp; + \frac{(-3)(-4)(-5)(-6)(-7)!}{(-7)!4!} R_4(y-x_*)t^{-7} + \hdots + \frac{(-3)(-4)\hdots(-2-n)(-3-n)!}{(-3-n)!n!} R_n(y-x_*)t^{-3-n} + \hdots \\ &amp; = &amp; R_0(y-x_*) t^{-3} - 3R_1(y-x_*)t^{-4} + 6R_2(y-x_*)t^{-5} - 10R_3(y-x_*)t^{-6} + 15R_4(y-x_*)t^{-7} + \hdots + (-1)^{n}\frac{(n+2)(n+1)}{2} R_n(y-x_*)t^{-3-n} + \hdots \\ &amp; = &amp; (-1)^0 \begin{pmatrix} 2 \\ 2 \end{pmatrix} R_0(y-x_*) t^{-3} +(-1)^1 \begin{pmatrix} 3 \\ 2 \end{pmatrix} R_1(y-x_*) t^{-4} +(-1)^2 \begin{pmatrix} 4 \\ 2 \end{pmatrix} R_2(y-x_*) t^{-5} +(-1)^3 \begin{pmatrix} 5 \\ 2 \end{pmatrix} R_3(y-x_*) t^{-6} \\ &amp;&amp; +(-1)^4 \begin{pmatrix} 6 \\ 2 \end{pmatrix} R_4(y-x_*) t^{-7} + \hdots + (-1)^n \begin{pmatrix} n+2 \\ 2 \end{pmatrix} R_n(y-x_*) t^{-3-n} + \hdots \\ S_4(y-x_*+t) &amp;=&amp; \frac{1}{(y-x_*+t)^4} = \sum_{n=0}^{\infty} \begin{pmatrix} -4 \\ n \end{pmatrix} (y-x_*)^n t^{-4-n} \\ &amp; = &amp; \begin{pmatrix} -4 \\ 0 \end{pmatrix} R_0(y-x_*) t^{-4-0} + \begin{pmatrix} -4 \\ 1 \end{pmatrix} R_1(y-x_*) t^{-4-1} + \begin{pmatrix} -4 \\ 2 \end{pmatrix} R_2(y-x_*) t^{-4-2} + \hdots + \begin{pmatrix} -4 \\ n \end{pmatrix} R_n(y-x_*) t^{-4-n} + \hdots \\ &amp; = &amp; \frac{(-4)!}{(-4-0)!0!} R_0(y-x^*) t^{-4-0} + \frac{(-4)!}{(-4-1)!1!} R_2(y-x_*)t^{-4-1} + \frac{(-4)!}{(-4-2)!2!} R_2(y-x_*)t^{-4-2} + \hdots + \frac{(-4)!}{(-4-n)!n!} R_n(y-x_*)t^{-4-n} + \hdots \\ &amp; = &amp; R_0(y-x_*) t^{-4} + \frac{(-4)(-5)!}{(-5)!1!} R_1(y-x_*)t^{-5} + + \frac{(-4)(-5)(-6)!}{(-6)!2!} R_2(y-x_*)t^{-6} + + \frac{(-4)(-5)(-6)(-7)!}{(-7)!3!} R_3(y-x_*)t^{-7} \\ &amp;&amp; + \frac{(-4)(-5)(-6)(-7)(-8)!}{(-8)!4!} R_4(y-x_*)t^{-8} + \hdots + \frac{(-4)(-5)\hdots(-3-n)(-4-n)!}{(-4-n)!n!} R_n(y-x_*)t^{-4-n} + \hdots \\ &amp; = &amp; R_0(y-x_*) t^{-4} - 4R_1(y-x_*)t^{-5} + 10R_2(y-x_*)t^{-6} - 20R_3(y-x_*)t^{-7} + 35R_4(y-x_*)t^{-8} + \hdots + (-1)^{n}\frac{(n+3)(n+2)(n+1)}{3!} R_n(y-x_*)t^{-4-n} + \hdots \\ &amp; = &amp; (-1)^0 \begin{pmatrix} 3 \\ 3 \end{pmatrix} R_0(y-x_*)t^{-4} + (-1)^1 \begin{pmatrix} 4 \\ 3 \end{pmatrix} R_1(y-x_*)t^{-5} + (-1)^2 \begin{pmatrix} 5 \\ 3 \end{pmatrix} R_2(y-x_*)t^{-6} + (-1)^3 \begin{pmatrix} 6 \\ 3 \end{pmatrix} R_3(y-x_*)t^{-7} \\ &amp;&amp; + (-1)^4 \begin{pmatrix} 7 \\ 3 \end{pmatrix} R_4(y-x_*)t^{-8} + \hdots + (-1)^n \begin{pmatrix} n+3 \\ 3 \end{pmatrix} R_n(y-x_*)t^{-4-n} + \hdots \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_240.png">
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} S_5(y-x_*+t) &amp;=&amp; \frac{1}{(y-x_*+t)^5} = \sum_{n=0}^{\infty} \begin{pmatrix} -5 \\ n \end{pmatrix} (y-x_*)^n t^{-5-n} \\ &amp; = &amp; \begin{pmatrix} -5 \\ 0 \end{pmatrix} R_0(y-x_*) t^{-5-0} + \begin{pmatrix} -5 \\ 1 \end{pmatrix} R_1(y-x_*) t^{-5-1} + \begin{pmatrix} -5 \\ 2 \end{pmatrix} R_2(y-x_*) t^{-5-2} + \hdots + \begin{pmatrix} -5 \\ n \end{pmatrix} R_n(y-x_*) t^{-5-n} + \hdots \\ &amp; = &amp; \frac{(-5)!}{(-5-0)!0!} R_0(y-x^*) t^{-5-0} + \frac{(-5)!}{(-5-1)!1!} R_2(y-x_*)t^{-5-1} + \frac{(-5)!}{(-5-2)!2!} R_2(y-x_*)t^{-5-2} + \hdots + \frac{(-5)!}{(-5-n)!n!} R_n(y-x_*)t^{-5-n} + \hdots \\ &amp; = &amp; R_0(y-x_*) t^{-5} + \frac{(-5)(-6)!}{(-6)!1!} R_1(y-x_*)t^{-6} + + \frac{(-5)(-6)(-7)!}{(-7)!2!} R_2(y-x_*)t^{-7} + + \frac{(-5)(-6)(-7)(-8)!}{(-8)!3!} R_3(y-x_*)t^{-8} \\ &amp;&amp; + \frac{(-5)(-6)(-7)(-8)(-9)!}{(-9)!4!} R_4(y-x_*)t^{-9} + \hdots + \frac{(-5)(-6)\hdots(-4-n)(-5-n)!}{(-5-n)!n!} R_n(y-x_*)t^{-5-n} + \hdots \\ &amp; = &amp; R_0(y-x_*) t^{-5} - 5R_1(y-x_*)t^{-6} + 15R_2(y-x_*)t^{-7} - 35R_3(y-x_*)t^{-8} + 70R_4(y-x_*)t^{-9} + \hdots + (-1)^{n}\frac{(n+4)(n+3)(n+2)(n+1)}{4!} R_n(y-x_*)t^{-5-n} + \hdots \\ &amp; = &amp; (-1)^0 \begin{pmatrix} 4 \\ 4 \end{pmatrix} R_0(y-x_*)t^{-5} + (-1)^1 \begin{pmatrix} 5 \\ 4 \end{pmatrix} R_1(y-x_*)t^{-6} + (-1)^2 \begin{pmatrix} 6 \\ 4 \end{pmatrix} R_2(y-x_*)t^{-7} + (-1)^3 \begin{pmatrix} 7 \\ 4 \end{pmatrix} R_3(y-x_*)t^{-8} \\ &amp;&amp; + (-1)^4 \begin{pmatrix} 8 \\ 4 \end{pmatrix} R_4(y-x_*)t^{-9} + \hdots + (-1)^n \begin{pmatrix} n+4 \\ 4 \end{pmatrix} R_n(y-x_*)t^{-5-n} + \hdots \\ &amp; \vdots &amp; \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_243.png">
</p>
<p>The equations define a transformation matrix that is infinite </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{bmatrix} S_0(y-x_*+t) \\ S_1(y-x_*+t) \\ S_2(y-x_*+t) \\ S_3(y-x_*+t) \\ S_4(y-x_*+t) \\ S_5(y-x_*+t) \\ \vdots \\ S_n(y-x_*+t) \\ \vdots \\ \end{bmatrix} = \begin{bmatrix} \ln(t) &amp; \frac{1}{t} &amp; -\frac{1}{2t^2} &amp; \frac{1}{3t^3} &amp; -\frac{1}{4t^4} &amp; \hdots &amp; \frac{(-1)^n}{nt^n} &amp; \hdots \\ t^{-1} &amp; -t^{-2} &amp; t^{-3} &amp; -t^{-4} &amp; t^{-5} &amp; \hdots &amp; (-1)^n t^{-1-n} &amp; \hdots \\ t^{-2} &amp; -2t^{-3} &amp; 3t^{-4} &amp; -4t^{-5} &amp; 5t^{-6} &amp; \hdots &amp; (-1)^n \begin{pmatrix} n+1 \\ 1 \end{pmatrix} t^{-2-n} &amp; \hdots \\ t^{-3} &amp; -3t^{-4} &amp; 6t^{-5} &amp; -10t^{-6} &amp; 15t^{-7} &amp; \hdots &amp; (-1)^n \begin{pmatrix} n+2 \\ 2 \end{pmatrix} t^{-3-n} &amp; \hdots \\ t^{-4} &amp; -4t^{-5} &amp; 10t^{-6} &amp; -20t^{-7} &amp; 35t^{-8} &amp; \hdots &amp; (-1)^n \begin{pmatrix} n+3 \\ 3 \end{pmatrix} t^{-4-n} &amp; \hdots \\ t^{-5} &amp; -5t^{-6} &amp; 15t^{-7} &amp; -35t^{-8} &amp; 70t^{-9} &amp; \hdots &amp; (-1)^n \begin{pmatrix} n+4 \\ 4 \end{pmatrix} t^{-5-n} &amp; \hdots \\ \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \hdots \\ \end{bmatrix} \begin{bmatrix} R_0(y-x_*) \\ R_1(y-x_*) \\ R_2(y-x_*) \\ R_3(y-x_*) \\ R_4(y-x_*) \\ R_5(y-x_*) \\ \vdots \\ R_n(y-x_*) \\ \vdots \\ \end{bmatrix} \]" src="./FMM_2D_ Main_Page_files/form_583.png">
</p>
<p>Note that each expansion of <img class="formulaInl" alt="$S_m(y-x_*+t)$" src="./FMM_2D_ Main_Page_files/form_209.png"> corresponds to a row of the infinite matrix. To form </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \ln(y-x_i) = \sum_{m=0}^{\infty} b_m(x_i,x_*-t) S_m(y-x_*+t) \]" src="./FMM_2D_ Main_Page_files/form_300.png">
</p>
<p> in terms of <img class="formulaInl" alt="$R_m(y-x_*)$" src="./FMM_2D_ Main_Page_files/form_301.png"> (the <img class="formulaInl" alt="$S|R$" src="./FMM_2D_ Main_Page_files/form_302.png"> translation) we multiply each equation above by the corresponding <img class="formulaInl" alt="$b_m(x_i,x_*-t)$" src="./FMM_2D_ Main_Page_files/form_303.png"> and add the equations.</p>
<p>We write the summation with respect to the <img class="formulaInl" alt="$R_m(y-x_*)$" src="./FMM_2D_ Main_Page_files/form_301.png">s. Since each column of the infinite matrix corresponds to a particular <img class="formulaInl" alt="$R_m(y-x_*)$" src="./FMM_2D_ Main_Page_files/form_301.png">, we seek a formula for the summation of each column. Formulas for each column can be found. However, for this translation the first row is slightly different than its neighbors in the corresponding columns. In particular, a formula for the first column (column 0) is difficult to determine with the first element being <img class="formulaInl" alt="$\ln(t)$" src="./FMM_2D_ Main_Page_files/form_306.png"> (located at (1,1) or (0,0) position). Due to this problem, the terms involving the first row have been split off from the rest of the summation (as shown below).</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \sum_{m=0}^{\infty} b_m(x_i,x_*-t) S_m(y-x_*+t) &amp; = &amp; b_0(x_i,x_*-t) \ln(t) R_0(y-x_*) + \sum_{n=1}^{\infty} b_0(x_i,x_*-t) \frac{(-1)^{n+1}}{n} \frac{1}{t^n} R_m(y-x_*) + \sum_{m=0}^{\infty} \left( \sum_{n=1}^{\infty} b_n(x_i,x_*-t) (-1)^m \begin{pmatrix} n+m-1 \\ m \end{pmatrix} t^{-m-n} \right) R_m(y-x_*) \\ &amp; = &amp; \sum_{m=0}^{\infty} a_m(x_i,x_*) R_m(y-x_*) \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_372.png">
</p>
<p> where </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} a_0(x_i,x_*) &amp;=&amp; b_0(x_i,x_*-t) \ln(t) + \sum_{n=1}^{\infty} b_n(x_i,x_*-t) (-1)^0 \begin{pmatrix} n+0 \\ 0 \end{pmatrix} t^{-0-n} \\ &amp; = &amp; b_0(x_i,x_*-t) \ln(t) + \sum_{n=1}^{\infty} b_n(x_i,x_*-t) \frac{1}{t^n} \\ a_1(x_i,x_*) &amp;=&amp; b_0(x_i,x_*-t) \frac{(-1)^2}{1} \frac{1}{t^1} + \sum_{n=1}^{\infty} b_n(x_i,x_*-t) (-1)^1 \begin{pmatrix} n+1 \\ 1 \end{pmatrix} t^{-1-n} \\ &amp;=&amp; - b_0(x_i,x_*-t) \frac{1}{(-t)^1} + \sum_{n=1}^{\infty} - b_n(x_i,x_*-t) (n+1) \frac{1}{t^{n+1}} \\ &amp;=&amp; \left( \frac{1}{(-t)^1} \sum_{n=1}^{\infty} b_n(x_i,x_*-t) \begin{pmatrix} n+1 \\ 1 \end{pmatrix} \frac{1}{t^n} \right) - \frac{b_0(x_i,x_*-t)}{(-t)^1} \\ a_2(x_i,x_*) &amp;=&amp; b_0(x_i,x_*-t) \frac{(-1)^3}{2} \frac{1}{t^2} + \sum_{n=1}^{\infty} b_n(x_i,x_*-t)(-1)^2 \begin{pmatrix} n+2-1 \\ 2 \end{pmatrix} t^{-2-n} \\ &amp;=&amp; \left( \frac{1}{(-t)^2} \sum_{n=1}^{\infty} b_n(x_i,x_*-t) \begin{pmatrix} n+1 \\ 2 \end{pmatrix} \frac{1}{t^n} \right) - \frac{b_0(x_i,x_*-t)}{2(-t)^2} \\ a_3(x_i,x_*) &amp;=&amp; b_0(x_i,x_*-t) \frac{(-1)^4}{3} \frac{1}{t^3} + \sum_{n=1}^{\infty} b_n(x_i,x_*-t)(-1)^3 \begin{pmatrix} n+3-1 \\ 3 \end{pmatrix} t^{-3-n} \\ &amp;=&amp; \left( \frac{1}{(-t)^3} \sum_{n=1}^{\infty} b_n(x_i,x_*-t) \begin{pmatrix} n+2 \\ 3 \end{pmatrix} \frac{1}{t^n} \right) - \frac{b_0(x_i,x_*-t)}{3(-t)^3} \\ &amp; \vdots &amp; \\ a_m(x_i,x_*) &amp;=&amp; \left( \frac{1}{(-t)^m} \sum_{n=1}^{\infty} b_n(x_i,x_*-t) \begin{pmatrix} n+m-1 \\ m \end{pmatrix} \frac{1}{t^n} \right) - \frac{b_0(x_i,x_*-t)}{m(-t)^m} \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_374.png">
</p>
<p>We note that <img class="formulaInl" alt="$\begin{pmatrix} m+n-1 \\ m \end{pmatrix} = \begin{pmatrix} m+n-1 \\ n-1 \end{pmatrix} $" src="./FMM_2D_ Main_Page_files/form_375.png"> due to the symmetry in the formula for combinations </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{pmatrix} m+n-1 \\ m \end{pmatrix} = \frac{(m+n-1)!}{(m+n-1-m)!m!} = \begin{pmatrix} m+n-1 \\ n-1 \end{pmatrix} \]" src="./FMM_2D_ Main_Page_files/form_376.png">
</p>
<p><b> Approximation </b></p>
<p>We will appproximate the SR-translation by truncating the series to <img class="formulaInl" alt="$p$" src="./FMM_2D_ Main_Page_files/form_543.png"> terms. This results in a <img class="formulaInl" alt="$p$" src="./FMM_2D_ Main_Page_files/form_543.png">-by- <img class="formulaInl" alt="$p$" src="./FMM_2D_ Main_Page_files/form_543.png"> translation matrix. Note that the indexing for <img class="formulaInl" alt="$p$" src="./FMM_2D_ Main_Page_files/form_543.png"> starts on one.</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \begin{bmatrix} \ln(t) &amp; \frac{1}{t} &amp; -\frac{1}{2t^2} &amp; \frac{1}{3t^3} &amp; -\frac{1}{4t^4} &amp; \hdots &amp; \frac{(-1)^{p-1}}{(p-1)t^{p-1}} \\ t^{-1} &amp; -t^{-2} &amp; t^{-3} &amp; -t^{-4} &amp; t^{-5} &amp; \hdots &amp; (-1)^{p-1} t^{-p} \\ t^{-2} &amp; -2t^{-3} &amp; 3t^{-4} &amp; -4t^{-5} &amp; 5t^{-6} &amp; \hdots &amp; (-1)^{p-1} \begin{pmatrix} p \\ 1 \end{pmatrix} t^{-p-1} \\ t^{-3} &amp; -3t^{-4} &amp; 6t^{-5} &amp; -10t^{-6} &amp; 15t^{-7} &amp; \hdots &amp; (-1)^{p-1} \begin{pmatrix} p + 1 \\ 2 \end{pmatrix} t^{-p-2} \\ t^{-4} &amp; -4t^{-5} &amp; 10t^{-6} &amp; -20t^{-7} &amp; 35t^{-8} &amp; \hdots &amp; (-1)^{p-1} \begin{pmatrix} p + 2 \\ 3 \end{pmatrix} t^{-p-3} \\ t^{-5} &amp; -5t^{-6} &amp; 15t^{-7} &amp; -35t^{-8} &amp; 70t^{-9} &amp; \hdots &amp; (-1)^{p-1} \begin{pmatrix} p + 3 \\ 4 \end{pmatrix} t^{-p-4} \\ \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \\ t^{-p+1} &amp; -(p-1)t^{-p} &amp; \begin{pmatrix} p \\ 2 \end{pmatrix} t^{-p-1} &amp; - \begin{pmatrix} p + 1 \\ 3 \end{pmatrix} t^{-p-2} &amp; \begin{pmatrix} p + 2 \\ 4 \end{pmatrix} t^{-p-3} &amp; \hdots &amp; (-1)^{p-1} \begin{pmatrix} 2p - 3 \\ p - 2 \end{pmatrix} t^{-2p+2} \\ \end{bmatrix} \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_589.png">
</p>
<p>We work with the transpose of this approximation in the code (getSR member function in Potential.cc). Multiplying the transpose of the matrix by the vector of coefficients for the series having the 'old' center results in the vector of coefficients for the series that has the 'new' center. For example, consider the coefficient <img class="formulaInl" alt="$a_0(x_i,x_*)$" src="./FMM_2D_ Main_Page_files/form_590.png">, one of the coefficients for the series with the 'new' center <img class="formulaInl" alt="$x_*$" src="./FMM_2D_ Main_Page_files/form_80.png">, and the set of coefficients <img class="formulaInl" alt="$b_i(x_i,x_*-t)$" src="./FMM_2D_ Main_Page_files/form_591.png"> for the series having the 'old' center <img class="formulaInl" alt="$x_*-t$" src="./FMM_2D_ Main_Page_files/form_326.png">. The formula for <img class="formulaInl" alt="$a_0(x_i,x_*)$" src="./FMM_2D_ Main_Page_files/form_590.png"> above is a linear combination of the first column of the translation matrix (above) with the coefficients of the series having the 'old' center. Namely,</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{bmatrix} ln(t) &amp; \frac{1}{t} &amp; \frac{1}{t^2} &amp; \hdots &amp; \frac{1}{t^{p-1}} \end{bmatrix} \begin{bmatrix} b_0 \\ b_1 \\ b_2 \\ \hdots \\ b_{p-1} \end{bmatrix} \]" src="./FMM_2D_ Main_Page_files/form_594.png">
</p>
<p>Therefore, it makes sense to work with the transpose matrix to perform the product as a row vector and column vector. We can see that <img class="formulaInl" alt="$a_1$" src="./FMM_2D_ Main_Page_files/form_593.png"> is a linear combination of the second column of the translation matrix and the coefficients of the series having the 'old' center. In the same manner we can obtain the other coefficients of the series with the 'new' center.</p>
<h3><a class="anchor" id="far_to_far_translation_subsubsection"></a>
(S|S) Translation (far-to-far translation)</h3>
<p>From the previous section, we had the alternate expansion</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \frac{1}{\tilde{t}^m} &amp;=&amp; \sum_{n=0}^{\infty} \begin{pmatrix} -m \\ n \end{pmatrix} z^{-m-n} t^n \\ &amp;=&amp; \sum_{n=0}^{\infty} \begin{pmatrix} -m \\ n \end{pmatrix} \frac{1}{z^{m+n}} t^n \\ \frac{1}{(y-x_*+t)^m} &amp; = &amp; \sum_{n=0}^{\infty} \begin{pmatrix} -m \\ n \end{pmatrix} \frac{1}{(y-x_*)^{m+n}} t^n \\ \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_249.png">
</p>
<p>Therefore, we have</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} S_0(y-x_*+t) &amp;=&amp; \ln(y-x_*+t) \\ &amp;=&amp; \ln(y-x_*) + t \frac{1}{y-x_*} - \frac{t^2}{2} \frac{1}{(y-x_*)^2} + \frac{t^3}{3} \frac{1}{(y-x_*)^3} - \frac{t^4}{4} \frac{1}{(y-x_*)^4} + \hdots + \frac{(-1)^nt^n}{n} \frac{1}{(y-x_*)^n} + \hdots + \\ &amp;=&amp; S_0(y-x_*) + t S_1(y-x_*) - \frac{t^2}{2} S_2(y-x_*) + \frac{t^3}{3} S_3(y-x_*) - \frac{t^4}{4} S_4(y-x_*) + \hdots + \frac{(-1)^n t^n}{n} S_n(y-x_*) + \hdots + \\ S_1(y-x_*+t) &amp;=&amp; \frac{1}{(y-x_*+t)} = \sum_{n=0}^{\infty} \begin{pmatrix} -1 \\ n \end{pmatrix} \frac{1}{(y-x_*)^{1+n}} t^n \\ &amp;=&amp; \begin{pmatrix} -1 \\ 0 \end{pmatrix} \frac{1}{(y-x_*)^{1+0}} t^0 + \begin{pmatrix} -1 \\ 1 \end{pmatrix} \frac{1}{(y-x_*)^{1+1}} t^1 + \begin{pmatrix} -1 \\ 2 \end{pmatrix} \frac{1}{(y-x_*)^{1+2}} t^2 + \begin{pmatrix} -1 \\ 3 \end{pmatrix} \frac{1}{(y-x_*)^{1+3}} t^3 + \hdots + \begin{pmatrix} -1 \\ n \end{pmatrix} \frac{1}{(y-x_*)^{1+n}} t^n + \hdots \\ &amp;=&amp; \frac{(-1)!}{(-1-0)!0!} S_{1}(y-x_*) + \frac{(-1)!}{(-1-1)!1!} t S_2(y-x_*) + \frac{(-1)!}{(-1-2)!2!} t^2 S_3(y-x_*) + \frac{(-1)!}{(-1-3)!3!} t^3 S_3(y-x_*) + \hdots + \frac{(-1)!}{(-1-n)!n!} t^n S_{n+1}(y-x_*)+\hdots \\ &amp;=&amp; S_1(y-x_*) - tS_2(y-x_*) + t^2S_3(y-x_*) - t^3S_4(y-x_*) + \hdots + (-1)^nt^nS_{n+1}(y-x_*)+\hdots \\ S_2(y-x_*+t) &amp;=&amp; \frac{1}{(y-x_*+t)^2} = \sum_{n=0}^{\infty} \begin{pmatrix} -2 \\ n \end{pmatrix} \frac{1}{(y-x_*)^{2+n}} t^n \\ &amp;=&amp; \begin{pmatrix} -2 \\ 0 \end{pmatrix} \frac{1}{(y-x_*)^{2+0}} t^0 + \begin{pmatrix} -2 \\ 1 \end{pmatrix} \frac{1}{(y-x_*)^{2+1}} t^1 + \begin{pmatrix} -2 \\ 2 \end{pmatrix} \frac{1}{(y-x_*)^{2+2}} t^2 + \begin{pmatrix} -2 \\ 3 \end{pmatrix} \frac{1}{(y-x_*)^{2+3}} t^3 + \hdots + \begin{pmatrix} -2 \\ n \end{pmatrix} \frac{1}{(y-x_*)^{2+n}} t^n + \hdots \\ &amp;=&amp; \frac{(-2)!}{(-2-0)!0!} S_2(y-x_*) + \frac{(-2)!}{(-2-1)!1!} t S_3(y-x_*) + \frac{(-2)!}{(-2-2)!2!} t^2 S_4(y-x_*) + \frac{(-2)!}{(-2-3)!3!}t^3 S_5(y-x_*) + \hdots + \frac{(-2)!}{(-2-n)!n!} t^n S_{n+2}(y-x_*) + \hdots \\ &amp;=&amp; S_2(y-x_*) - 2 t S_3(y-x_*) + 3t^2S_4(y-x_*) - 4t^3S_5(y-x_*) + \hdots + (-1)^n (n+1)t^n S_{n+2}(y-x_*)+\hdots\\ S_3(y-x_*+t) &amp;=&amp; \frac{1}{(y-x_*+t)^3} = \sum_{n=0}^{\infty} \begin{pmatrix} -3 \\ n \end{pmatrix} \frac{1}{(y-x_*)^{3+n}} t^n \\ &amp;=&amp; \begin{pmatrix} -3 \\ 0 \end{pmatrix} \frac{1}{(y-x_*)^{3+0}} t^0 + \begin{pmatrix} -3 \\ 1 \end{pmatrix} \frac{1}{(y-x_*)^{3+1}} t^1 + \begin{pmatrix} -3 \\ 2 \end{pmatrix} \frac{1}{(y-x_*)^{3+2}} t^2 + \begin{pmatrix} -3 \\ 3 \end{pmatrix} \frac{1}{(y-x_*)^{3+3}} t^3 + \hdots + \begin{pmatrix} -3 \\ n \end{pmatrix} \frac{1}{(y-x_*)^{3+n}} t^n + \hdots \\ &amp;=&amp; \frac{(-3)!}{(-3-0)!0!} S_3(y-x_*) + \frac{(-3)!}{(-3-1)!1!} t S_4(y-x_*) + \frac{(-3)!}{(-3-2)!2!} t^2 S_5(y-x_*) + \frac{(-3)!}{(-3-3)!3!}t^3 S_6(y-x_*) + \hdots + \frac{(-3)!}{(-3-n)!n!} t^n S_{n+3}(y-x_*) + \hdots \\ &amp;=&amp; S_3(y-x_*) - 3 t S_4(y-x_*) + 6t^2S_5(y-x_*) - 10t^3S_6(y-x_*) + \hdots + (-1)^n \frac{(n+2)(n+1)}{2} t^n S_{n+3}(y-x_*)+\hdots\\ S_4(y-x_*+t) &amp;=&amp; \frac{1}{(y-x_*+t)^4} = \sum_{n=0}^{\infty} \begin{pmatrix} -4 \\ n \end{pmatrix} \frac{1}{(y-x_*)^{4+n}} t^n \\ &amp;=&amp; \begin{pmatrix} -4 \\ 0 \end{pmatrix} \frac{1}{(y-x_*)^{4+0}} t^0 + \begin{pmatrix} -4 \\ 1 \end{pmatrix} \frac{1}{(y-x_*)^{4+1}} t^1 + \begin{pmatrix} -4 \\ 2 \end{pmatrix} \frac{1}{(y-x_*)^{4+2}} t^2 + \begin{pmatrix} -4 \\ 3 \end{pmatrix} \frac{1}{(y-x_*)^{4+3}} t^3 + \hdots + \begin{pmatrix} -4 \\ n \end{pmatrix} \frac{1}{(y-x_*)^{4+n}} t^n + \hdots \\ &amp;=&amp; \frac{(-4)!}{(-4-0)!0!} S_4(y-x_*) + \frac{(-4)!}{(-4-1)!1!} t S_5(y-x_*) + \frac{(-4)!}{(-4-2)!2!} t^2 S_6(y-x_*) + \frac{(-4)!}{(-4-3)!3!}t^3 S_7(y-x_*) + \hdots + \frac{(-4)!}{(-4-n)!n!} t^n S_{n+4}(y-x_*) + \hdots \\ &amp;=&amp; S_4(y-x_*) - 4 t S_5(y-x_*) + 10t^2S_6(y-x_*) - 20t^3S_7(y-x_*) + \hdots + (-1)^n \frac{(n+3)(n+2)(n+1)}{3!} t^n S_{n+4}(y-x_*)+\hdots\\ \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_605.png">
</p>
<p>The transformation matrix is </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{bmatrix} S_0(y-x_*+t) \\ S_1(y-x_*+t) \\ S_2(y-x_*+t) \\ S_3(y-x_*+t) \\ S_4(y-x_*+t) \\ S_5(y-x_*+t) \\ S_6(y-x_*+t) \\ \vdots \\ S_n(y-x_*) \\ S_{n+1}(y-x_*) \\ S_{n+2}(y-x_*) \\ S_{n+3}(y-x_*) \\ S_{n+4}(y-x_*) \\ \vdots \end{bmatrix} = \left[ \begin{array}{cccccccccccc} 1 &amp; t &amp; - \frac{t^2}{2} &amp; \frac{t^3}{3} &amp; \hdots &amp; &amp; \frac{(-1)^n t^n}{n} &amp; &amp; \hdots &amp; \hdots &amp; \hdots &amp; \hdots \\ 0 &amp; 1 &amp; -t &amp; t^{2} &amp; &amp; \hdots &amp; &amp; (-1)^n t^{n} &amp; \hdots &amp; \hdots &amp; \hdots &amp; \hdots \\ 0 &amp; 0 &amp; 1 &amp; -2t &amp; 3t^{2} &amp; &amp; \hdots &amp; &amp;(-1)^n \begin{pmatrix} n+1 \\ 1 \end{pmatrix} t^n &amp; \hdots &amp; \hdots &amp; \hdots \\ 0 &amp; 0 &amp; 0 &amp; 1 &amp; -3t &amp; 6t^{2} &amp; &amp; \hdots &amp; &amp; (-1)^n \begin{pmatrix} n+2 \\ 2 \end{pmatrix} t^{n} &amp; \hdots &amp; \hdots \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; -4t &amp; 10t^2 &amp; &amp; \hdots &amp; &amp; (-1)^n \begin{pmatrix} n+3 \\ 3 \end{pmatrix} t^n &amp; \hdots \\ \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \ddots &amp; \ddots &amp; \ddots &amp; \ddots &amp; &amp; \hdots &amp; \vdots &amp; \ddots \end{array} \right] \begin{bmatrix} S_0(y-x_*) \\ S_1(y-x_*) \\ S_2(y-x_*) \\ S_3(y-x_*) \\ S_4(y-x_*) \\ S_5(y-x_*) \\ S_6(y-x_*) \\ \vdots \\ S_n(y-x_*) \\ S_{n+1}(y-x_*) \\ S_{n+2}(y-x_*) \\ S_{n+3}(y-x_*) \\ S_{n+4}(y-x_*) \\ \vdots \end{bmatrix} \]" src="./FMM_2D_ Main_Page_files/form_316.png">
</p>
<p>The formula for the coefficients <img class="formulaInl" alt="$b_m(x_i,x_*)$" src="./FMM_2D_ Main_Page_files/form_360.png"> in the translation </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \sum_{m=0}^{\infty} b_m(x_i,x_*-t) S_m(y-x_*+t) = \sum_{m=0}^{\infty} b_m(x_i,x_*)S_m(y-x_*) \]" src="./FMM_2D_ Main_Page_files/form_358.png">
</p>
<p> is obtained by multiplying the equations above by the corresponding <img class="formulaInl" alt="$b_m(x_i,x_*-t)$" src="./FMM_2D_ Main_Page_files/form_303.png"> and adding the equations resulting in the coefficients </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} b_0(x_i,x_*) &amp;=&amp; b_0(x_i,x_*-t) \\ b_1(x_i,x_*) &amp;=&amp; b_0(x_i,x_*-t)t + b_1(x_i,x_*-t) \\ b_2(x_i,x_*) &amp;=&amp; -b_0(x_i,x_*-t)\frac{t^2}{2} - b_1(x_i,x_*-t)t + b_2(x_i,x_*-t) \\ b_3(x_i,x_*) &amp;=&amp; b_0(x_i,x_*-t)\frac{t^3}{3} + b_1(x_i,x_*-t)t^2 - b_2(x_i,x_*-t) 2t + b_3(x_i,x_*-t) \\ &amp; \vdots &amp; \\ b_n(x_i,x_*) &amp;=&amp; -b_0(x_i,x_*-t) \frac{(-t)^n}{n} + \sum_{m=1}^{n} b_m(x_i,x_*-t) \begin{pmatrix} n-1 \\ m -1 \end{pmatrix} (-t)^{n-m} \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_363.png">
</p>
<p><b> Approximation </b></p>
<p>We will also appproximate the translation. Truncating the series to <img class="formulaInl" alt="$p$" src="./FMM_2D_ Main_Page_files/form_543.png"> terms, results in a <img class="formulaInl" alt="$p$" src="./FMM_2D_ Main_Page_files/form_543.png">-by- <img class="formulaInl" alt="$p$" src="./FMM_2D_ Main_Page_files/form_543.png"> matrix. Note that the indexing for <img class="formulaInl" alt="$p$" src="./FMM_2D_ Main_Page_files/form_543.png"> starts on one.</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \left[ \begin{array}{ccccccccc} 1 &amp; t &amp; - \frac{t^2}{2} &amp; \frac{t^3}{3} &amp; \frac{t^4}{4} &amp; \frac{t^5}{5} &amp; \frac{t^6}{6} &amp; \hdots &amp; \frac{(-1)^{p} t^{p-1}}{p-1} \\ 0 &amp; 1 &amp; -t &amp; t^{2} &amp; -t^{3} &amp; t^{4} &amp; t^{5} &amp; \hdots &amp; (-1)^{p} t^{p-2} \\ 0 &amp; 0 &amp; 1 &amp; -2t &amp; 3t^{2} &amp; 4t^{3} &amp; 5t^{4} &amp; \hdots &amp; \begin{pmatrix} p-2 \\ 1 \end{pmatrix} (-1)^{p-1} t^{p-3} \\ 0 &amp; 0 &amp; 0 &amp; 1 &amp; -3t &amp; 6t^{2} &amp; 10t^{3} &amp; \hdots &amp; \begin{pmatrix} p-2 \\ 2 \end{pmatrix} (-1)^{p-2} t^{p-4} \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; -4t &amp; 10t^2 &amp; \hdots &amp; \begin{pmatrix} p-2 \\ 3 \end{pmatrix} (-1)^{p-3} t^{p-5} \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; \ddots &amp; \ddots &amp; \vdots \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; \ddots &amp; \vdots \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \ddots &amp; \vdots \\ 0 &amp; \hdots &amp; &amp; \hdots &amp; &amp; &amp; \hdots &amp; 0 &amp; 1 \end{array} \right] \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_550.png">
</p>
<p>The transpose (below) is used in the source code</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \left[ \begin{array}{ccccccccc} 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \hdots &amp; 0 \\ t &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \hdots &amp; 0 \\ - \frac{t^2}{2} &amp; -t &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \hdots &amp; 0 \\ \frac{t^3}{3} &amp; t^{2} &amp; -2t &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; \hdots &amp; 0 \\ \frac{t^4}{4} &amp; -t^{3} &amp; 3t^{2} &amp; -3t &amp; 1 &amp; 0 &amp; 0 &amp; \hdots &amp; 0 \\ \frac{t^5}{5} &amp; t^{4} &amp; 4t^{3} &amp; 6t^{2} &amp; -4t &amp; 1 &amp; 0 &amp; \ddots &amp; 0 \\ \frac{t^6}{6} &amp; t^{5} &amp; 5t^{4} &amp; 10t^{3} &amp; 10t^2 &amp; \ddots &amp; 1 &amp; \ddots &amp; 0 \\ \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \ddots &amp; \ddots &amp; 0 \\ \frac{(-1)^{p} t^{p-1}}{p-1} &amp; (-1)^{p} t^{p-2} &amp; \begin{pmatrix} p-2 \\ 1 \end{pmatrix} (-1)^{p-1} t^{p-3} &amp; \begin{pmatrix} p-2 \\ 2 \end{pmatrix} (-1)^{p-2} t^{p-4} &amp; \begin{pmatrix} p-2 \\ 3 \end{pmatrix} (-1)^{p-3} t^{p-5} &amp; \hdots &amp; \hdots &amp; \hdots &amp; 1 \\ \end{array} \right] \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_569.png">
</p>
<p>In the code, the elements of the transpose are defined recursively with respect to a given row. We can see the general pattern in the last row of the transpose matrix. We traverse a row working from the main diagonal and moving left. We can see that the power of <img class="formulaInl" alt="$t$" src="./FMM_2D_ Main_Page_files/form_164.png"> increases by one as we move from element to element. The sign alternates from negative to positive. To determine the behavior of the coefficients while progressing left from the main diagonal element by element, consider the <img class="formulaInl" alt="$6^{th}$" src="./FMM_2D_ Main_Page_files/form_570.png"> and <img class="formulaInl" alt="$7^{th}$" src="./FMM_2D_ Main_Page_files/form_571.png"> rows. Following the progression from left to right we may recognize if as Pascal's Triangle or the progression of combinations as shown in the formulas for the coefficients in bottom row of the matrix.</p>
<p>Take for example the <img class="formulaInl" alt="$6^{th}$" src="./FMM_2D_ Main_Page_files/form_570.png"> row. </p>
<pre class="fragment">     The first coefficient from the left of the main diagonal 1 is 4.
     This can be obtained from the formula at the bottom of this column with p = 6
</pre> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{pmatrix} 6 - 2 \\ 3 \end{pmatrix} = \begin{pmatrix} 4 \\ 3 \end{pmatrix} = \frac{ 4! }{ 3! (4-3)!} = \frac{ 4 \cdot 3 \cdot 2 \cdot 1 }{ 3 \cdot 2 \cdot 1 \cdot 1} = \frac{ 4 }{ 1 } \]" src="./FMM_2D_ Main_Page_files/form_580.png">
</p>
 <pre class="fragment">    We could obtain this from multiplying the main diagonal value 1.0 by j-1 = 5- 1 = 4 and dividing the result by (i-j) = 6-5 = 1

    The second coefficient from the left is 6.
    From the formula at the bottom of this column with p = 6
</pre> <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{pmatrix} 6 - 2 \\ 2 \end{pmatrix} = \begin{pmatrix} 4 \\ 2 \end{pmatrix} = \frac{ 4! }{ 2! (4-2)!} = \frac{ 4 \cdot 3 \cdot 2 \cdot 1 }{ 2 \cdot 1 \cdot 2 \cdot 1} = \frac{ 4 \cdot 3 }{ 2 \cdot 1 } = \frac{4}{1} \frac{3}{2} \]" src="./FMM_2D_ Main_Page_files/form_581.png">
</p>
 <pre class="fragment">    We could obtain this from multiplying the previous value 4/1 by j - 1 = 4 - 1 = 3 and dividing the
    result by (i-j) = 6 - 4 = 2.

    We see this pattern and method in the source code.
</pre><h1><a class="anchor" id="mlfmm_algorithm_section"></a>
MLFMM Algorithm</h1>
<p>The Multilevel Fast Multiple Method algorithm can be separated into four steps.</p>
<h2><a class="anchor" id="quadtree_partition_subsection"></a>
Quadtree Partition</h2>
<p>First we enclose a square around the set of target and source particles. This code will be based on the assumption that the particles are uniformly distributed. This assumption allows us to easily divide (or partition) the square up and have the same number of particles in each subdivision (or level of partition).</p>
<p>We call the original square level zero ( <img class="formulaInl" alt="$l = 0$" src="./FMM_2D_ Main_Page_files/form_410.png">) of the partition and use <img class="formulaInl" alt="$l$" src="./FMM_2D_ Main_Page_files/form_158.png"> to represent the level. The subdivision technique is to first take the original square and connect lines from the opposing edges' midpoints. This divides the original square into four smaller squares with the same size (sides have the same length). This is known as a quadtree.</p>
<p>Due to the uniform distribution of the particles, each subdivision also has approximately the same number of particles. We call this first level of subdivision level 1 ( <img class="formulaInl" alt="$l = 1$" src="./FMM_2D_ Main_Page_files/form_411.png">). We perform the same technique on each of the four square of <img class="formulaInl" alt="$l=1$" src="./FMM_2D_ Main_Page_files/form_412.png">. This results in level <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png"> having <img class="formulaInl" alt="$4 * 4 = 16 $" src="./FMM_2D_ Main_Page_files/form_382.png"> squares.</p>
<p>So far, we see that (i) level zero, <img class="formulaInl" alt="$l=0$" src="./FMM_2D_ Main_Page_files/form_414.png">, has <img class="formulaInl" alt="$1 = 4^0$" src="./FMM_2D_ Main_Page_files/form_384.png"> cells (squares) in its partition, (ii) level one, <img class="formulaInl" alt="$l=1$" src="./FMM_2D_ Main_Page_files/form_412.png">, has <img class="formulaInl" alt="$4^1 = 4$" src="./FMM_2D_ Main_Page_files/form_385.png"> square (or cells) making up its partition and <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png">, (iii) level two, has <img class="formulaInl" alt="$4^2 = 16$" src="./FMM_2D_ Main_Page_files/form_386.png"> cells making up its partition. Continuing in this manner, level <img class="formulaInl" alt="$l$" src="./FMM_2D_ Main_Page_files/form_158.png">, <img class="formulaInl" alt="$l = l $" src="./FMM_2D_ Main_Page_files/form_415.png"> will have <img class="formulaInl" alt="$4^l$" src="./FMM_2D_ Main_Page_files/form_388.png"> cells in its partition of the original square. The highest (or finest) level of refinement will be denoted level <img class="formulaInl" alt="$l=L$" src="./FMM_2D_ Main_Page_files/form_409.png">.</p>
<p>We will uniquely identify each square or cell by its ordered pair <img class="formulaInl" alt="$(n,l$" src="./FMM_2D_ Main_Page_files/form_389.png"> where <img class="formulaInl" alt="$l$" src="./FMM_2D_ Main_Page_files/form_158.png"> is the level that the cell lives on and <img class="formulaInl" alt="$n$" src="./FMM_2D_ Main_Page_files/form_74.png"> is its index number on that level. We will talk about the indexing next.</p>
<p>To perform the MLFMM we partition each level into four disjoint sets or domains (see the image below): (i) the box <img class="formulaInl" alt="$E_1(n,l) = (n,l)$" src="./FMM_2D_ Main_Page_files/form_390.png"> at level <img class="formulaInl" alt="$l$" src="./FMM_2D_ Main_Page_files/form_158.png"> having index number <img class="formulaInl" alt="$n$" src="./FMM_2D_ Main_Page_files/form_74.png"> (ii) the nearest neighbors of the box <img class="formulaInl" alt="$E_2(n,l)$" src="./FMM_2D_ Main_Page_files/form_391.png"> (which includes the box itself) (iii) the entire domain (original square) without the nearest neighbors <img class="formulaInl" alt="$E_3(n,l) = E_1(0,0) \setminus E_2(n,l)$" src="./FMM_2D_ Main_Page_files/form_392.png"> and (iv) the interaction list <img class="formulaInl" alt="$E_4(n,l)$" src="./FMM_2D_ Main_Page_files/form_393.png"> made up of the set of parents of the nearest neighbors without the nearest neighbors.</p>
<div class="image">
<img src="./FMM_2D_ Main_Page_files/lists.png" alt="lists.png">
</div>
<p>Each domain contains particles. We will consider each particle a source <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> having a potentials <img class="formulaInl" alt="$u_i$" src="./FMM_2D_ Main_Page_files/form_396.png">. Recall that <img class="formulaInl" alt="$u_i \Phi(y,x_i)$" src="./FMM_2D_ Main_Page_files/form_397.png"> is used to calculate the action of a source <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> on a target particle <img class="formulaInl" alt="$y$" src="./FMM_2D_ Main_Page_files/form_79.png">. The potentials due to sources in each domain are </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \Phi_1^{(n,l)} (y) \colon = \sum_{x_i \in E_1(n,l)} u_i \Phi(y,x_i) \\ \Phi_2^{(n,l)} (y) \colon = \sum_{x_i \in E_2(n,l)} u_i \Phi(y,x_i) \\ \Phi_3^{(n,l)} (y) \colon = \sum_{x_i \in E_3(n,l)} u_i \Phi(y,x_i) \\ \Phi_4^{(n,l)} (y) \colon = \sum_{x_i \in E_4(n,l)} u_i \Phi(y,x_i) \\ \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_398.png">
</p>
<h2><a class="anchor" id="far_field_expansion_subsection"></a>
Far-Field Expansions</h2>
<p>We start at the highest level of refinement <img class="formulaInl" alt="$l=L$" src="./FMM_2D_ Main_Page_files/form_409.png">. Let the particle <img class="formulaInl" alt="$y$" src="./FMM_2D_ Main_Page_files/form_79.png"> be an arbitrary target located somewhere in the original square (E_1(0,0) - cell with index <img class="formulaInl" alt="$n=0$" src="./FMM_2D_ Main_Page_files/form_399.png"> at refinement level <img class="formulaInl" alt="$l=0$" src="./FMM_2D_ Main_Page_files/form_414.png">). Consider any cell <img class="formulaInl" alt="$E_1(n,L)$" src="./FMM_2D_ Main_Page_files/form_400.png"> in the refinement <img class="formulaInl" alt="$l=L$" src="./FMM_2D_ Main_Page_files/form_409.png">. For each source <img class="formulaInl" alt="$x_i \in E_1(n,L)$" src="./FMM_2D_ Main_Page_files/form_401.png">, we write <img class="formulaInl" alt="$\Phi(y,x_i)$" src="./FMM_2D_ Main_Page_files/form_402.png"> as a Taylor series S-Expansion (far-field expansion). We do this for every cell <img class="formulaInl" alt="$E_1(n.L)$" src="./FMM_2D_ Main_Page_files/form_403.png">. Therefore, we have two loops: (i) an outside loop over the cells of refinement level <img class="formulaInl" alt="$L$" src="./FMM_2D_ Main_Page_files/form_378.png"> and (ii) an inside loop over the sources in that cell.</p>
<p>Recall that for the R and S-expansions there is a center, <img class="formulaInl" alt="$x_*$" src="./FMM_2D_ Main_Page_files/form_80.png"> for example. For these expansions, we make the center of the cell <img class="formulaInl" alt="$x_c^{(n,L)}$" src="./FMM_2D_ Main_Page_files/form_404.png"> the center of the expansion.</p>
<p>Note that for each <img class="formulaInl" alt="$x_i \in E_1(n,l)$" src="./FMM_2D_ Main_Page_files/form_405.png">, the far-field expansion has the same components <img class="formulaInl" alt="$S_m(y-x_c) = \frac{1}{y-c_x}^m$" src="./FMM_2D_ Main_Page_files/form_406.png">. Therefore, a single far-field series can be formed </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Phi_1^{(n,L)}(y) = \sum_{x_i \in E_1(n,L)} u_i \Phi(y,x_i) = \sum_{m=0}^{\infty} C_m^{(n,L)} S_m(y-x_c) \]" src="./FMM_2D_ Main_Page_files/form_407.png">
</p>
<p>where </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ C^{(n,L)}_m = \sum_{x_i \in E_1(n,L)} u_i b_m(x_i,x_c^{(n,L)}) \]" src="./FMM_2D_ Main_Page_files/form_408.png">
</p>
<h2><a class="anchor" id="upward_pass_subsection"></a>
Upward Pass</h2>
<p>We now have far-field expansions for each source in each cell at the highest refinement level <img class="formulaInl" alt="$l=L$" src="./FMM_2D_ Main_Page_files/form_409.png">. Our next step is translate these expansions up the refinement levels.</p>
<p>We start at the second highest refinement level <img class="formulaInl" alt="$l = L-1$" src="./FMM_2D_ Main_Page_files/form_416.png">. Each cell at this refinement level is the parent of four children that are cells of refinement level <img class="formulaInl" alt="$l = L$" src="./FMM_2D_ Main_Page_files/form_417.png">. We take an arbitrary cell <img class="formulaInl" alt="$(n,L-1)$" src="./FMM_2D_ Main_Page_files/form_418.png"> at this refinement level <img class="formulaInl" alt="$l = L-1$" src="./FMM_2D_ Main_Page_files/form_416.png"> and translate the far-field expansions from the sources in this parent cell to the center of the cell <img class="formulaInl" alt="$x_c^{(n,L-1)}$" src="./FMM_2D_ Main_Page_files/form_419.png">. That is, for each source <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> in each of the children cells <img class="formulaInl" alt="$(child_i(n,L-1),L)$" src="./FMM_2D_ Main_Page_files/form_420.png"> for <img class="formulaInl" alt="$1 \leq i \leq 4$" src="./FMM_2D_ Main_Page_files/form_422.png"> we translate the far-field expansion from the center of the child cell <img class="formulaInl" alt="$x_c^{(child_i(n,L-1),L)}$" src="./FMM_2D_ Main_Page_files/form_421.png"> to the center of the parent cell <img class="formulaInl" alt="$x_c^{(n,L-1)}$" src="./FMM_2D_ Main_Page_files/form_419.png">.</p>
<p>If, for example, we have 4 source particles in each child cell, then we will be translating <img class="formulaInl" alt="$4*4=16$" src="./FMM_2D_ Main_Page_files/form_423.png"> expansions to the center of the parent cell. However, for each child cell, we have written the four expansions of that cell as a single series. Therefore, we are really translating only four expansions, one for each child cell.</p>
<p>We now have all the four far-field expansions corresponding to each of the child cells, centered at the center of the parent cell. Therefore, each expansion now has the same powers <img class="formulaInl" alt="$S_m(y-x_c^{(n,L-1)})$" src="./FMM_2D_ Main_Page_files/form_486.png"> and we can write all the expansions as a single series </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Phi_1^{(n,L-1)}(y) = \sum_{n=0}^{\infty} C_m^{(n,L-1)} S_m(y-x_c^{(n,L-1)}) \]" src="./FMM_2D_ Main_Page_files/form_427.png">
</p>
<p> where the coefficient <img class="formulaInl" alt="$C_m^{(n,L-1)}$" src="./FMM_2D_ Main_Page_files/form_433.png"> depends on the far-field to far-field translation from child centers to the parent center.</p>
<p>Using our work on S|S translations, let's look at the coefficients <img class="formulaInl" alt="$C_m^{(n,L-1)}$" src="./FMM_2D_ Main_Page_files/form_433.png"> for this first step of translations. We can write down the exact formula for the <img class="formulaInl" alt="$C_m^{(n,L-1)}$" src="./FMM_2D_ Main_Page_files/form_433.png">. From our work on <img class="formulaInl" alt="$S|S$" src="./FMM_2D_ Main_Page_files/form_321.png"> translations, we have the correspondences </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ y-x_* \leftrightarrow y-x_c^{(n&#39;,L)} \quad \mbox{and} \quad y-x_*+t = y-(x_*-t) \leftrightarrow y-x_c^{(n,L-1)} \]" src="./FMM_2D_ Main_Page_files/form_430.png">
</p>
<p> Then <img class="formulaInl" alt="$y-x_c^{(n&#39;,L)} = y-x_c^{(n,L-1)} + t$" src="./FMM_2D_ Main_Page_files/form_431.png"> implies <img class="formulaInl" alt="$t = x_c^{(n,L-1)} - x_c^{(n&#39;,L)}$" src="./FMM_2D_ Main_Page_files/form_432.png">, and</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} C_0^{(n,L-1)} &amp;=&amp; \sum_{n&#39; \in child(n,L-1)} C_0^{(n&#39;,L)} \\ C_m^{(n,L-1)} &amp;=&amp; \sum_{n&#39; \in child(n,L-1)} \left( -C_0^{(n&#39;,L)} \frac{(x_c^{(n&#39;,L)}-x_c^{(n,L-1)})^m}{m} + \sum_{k=1}^{m} C_k^{(n&#39;,L)} \begin{pmatrix} m-1 \\ k-1 \end{pmatrix} (x_c^{(n&#39;,L)}-x_c^{(n,L-1)})^{m-k} \right) \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_438.png">
</p>
<p>We repeat this process for each cell (n,L-2) of the next refinement level <img class="formulaInl" alt="$l=L-2$" src="./FMM_2D_ Main_Page_files/form_439.png"> up by translating the expansion each of the four children <img class="formulaInl" alt="$n&#39; \in child(n,L-2)$" src="./FMM_2D_ Main_Page_files/form_440.png"> has to the center <img class="formulaInl" alt="$x_c^{(n,L-2)}$" src="./FMM_2D_ Main_Page_files/form_441.png"> of the parent cell <img class="formulaInl" alt="$(n,L-2)$" src="./FMM_2D_ Main_Page_files/form_442.png">. We continue the process until we finish at level <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png">.</p>
<h2><a class="anchor" id="downward_pass_subsection"></a>
Downward Pass</h2>
<p>In this part of the algorithm we are working from the refinement level two ( <img class="formulaInl" alt="$l = 2$" src="./FMM_2D_ Main_Page_files/form_443.png">) down to refinement level <img class="formulaInl" alt="$l = L$" src="./FMM_2D_ Main_Page_files/form_417.png">.</p>
<p>Our first step will be to translate the far-field expansions that we worked on in the upward pass to R-expansions using an <img class="formulaInl" alt="$(S|R)$" src="./FMM_2D_ Main_Page_files/form_444.png"> translation. For each cell <img class="formulaInl" alt="$(n,2)$" src="./FMM_2D_ Main_Page_files/form_445.png"> of level <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png"> we translate the far-field expansions of the cells in its interactive list to its center <img class="formulaInl" alt="$x_c^{(n,2)}$" src="./FMM_2D_ Main_Page_files/form_446.png"> using an <img class="formulaInl" alt="$(S|R)$" src="./FMM_2D_ Main_Page_files/form_444.png"> translation.</p>
<p>Once <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png"> is complete, we step down to <img class="formulaInl" alt="$l=3$" src="./FMM_2D_ Main_Page_files/form_447.png"> and perform the same method for the cells <img class="formulaInl" alt="$(n,3)$" src="./FMM_2D_ Main_Page_files/form_448.png"> in level <img class="formulaInl" alt="$l=3$" src="./FMM_2D_ Main_Page_files/form_447.png">.</p>
<p><b> Local Expansions </b></p>
<p>Recall that <img class="formulaInl" alt="$\Phi_4^{(n,l)}(y)$" src="./FMM_2D_ Main_Page_files/form_449.png"> was defined as </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Phi_4^{(n,l)}(y) = \sum_{x_i \in E_4(n,l)} u_i \Phi(y,x_i) \]" src="./FMM_2D_ Main_Page_files/form_462.png">
</p>
<p> where <img class="formulaInl" alt="$E_4(n,l)$" src="./FMM_2D_ Main_Page_files/form_393.png"> was called the interaction list and was made up of the cells that were children of the nearest neighbors of the parent of the cell of interest <img class="formulaInl" alt="$(n,l)$" src="./FMM_2D_ Main_Page_files/form_451.png">. But the list did not include the nearest neighbors of cell <img class="formulaInl" alt="$(n,l)$" src="./FMM_2D_ Main_Page_files/form_451.png"> or cell <img class="formulaInl" alt="$(n,l)$" src="./FMM_2D_ Main_Page_files/form_451.png"> itself (see the figure below).</p>
<p>Note that level <img class="formulaInl" alt="$l=0$" src="./FMM_2D_ Main_Page_files/form_414.png"> and level <img class="formulaInl" alt="$l=1$" src="./FMM_2D_ Main_Page_files/form_412.png"> do not have an interaction list (only nearest neighbors), and that is why we have started our work at level <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png">. Level <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png"> is the first level to have an interaction list, where approximations (and not direct calculations of the logarithmic function) and the fast multipole method can be done. Further, level <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png"> has the unique property that for any cell <img class="formulaInl" alt="$(n,2)$" src="./FMM_2D_ Main_Page_files/form_445.png"> the entire domain <img class="formulaInl" alt="$E_1(0,0)$" src="./FMM_2D_ Main_Page_files/form_452.png"> consists of that cells nearest neighbors and its interaction list. This can not be said for higher refinement levels (see the figure below).</p>
<p>We can say this symbolically by recalling the definition </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Phi_3^{(n,l)} (y) \colon = \sum_{x_i \in E_3(n,l)} u_i \Phi(y,x_i) \]" src="./FMM_2D_ Main_Page_files/form_453.png">
</p>
<p> where <img class="formulaInl" alt="$E_3(n,l)$" src="./FMM_2D_ Main_Page_files/form_454.png"> is the set of all cells in the entire domain <img class="formulaInl" alt="$E(0,0)$" src="./FMM_2D_ Main_Page_files/form_455.png"> that are not nearest neighbors of <img class="formulaInl" alt="$(n,l)$" src="./FMM_2D_ Main_Page_files/form_451.png">.</p>
<p>Therefore, for level <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png"> </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Phi_3^{(n,2)} (y) = \Phi_4^{(n,2)}(y). \]" src="./FMM_2D_ Main_Page_files/form_482.png">
</p>
<p> We want to be able to state <img class="formulaInl" alt="$\Phi_3^{(n,l)}(y)$" src="./FMM_2D_ Main_Page_files/form_457.png"> for any level <img class="formulaInl" alt="$l$" src="./FMM_2D_ Main_Page_files/form_158.png">. We make the argument for the method to determine <img class="formulaInl" alt="$\Phi_3^{(n,l)}(y)$" src="./FMM_2D_ Main_Page_files/form_457.png"> for any level <img class="formulaInl" alt="$l$" src="./FMM_2D_ Main_Page_files/form_158.png">.</p>
<p>To help illustrate the method, shown below are figures of levels <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png"> to <img class="formulaInl" alt="$l=5$" src="./FMM_2D_ Main_Page_files/form_466.png">. To help establish the method, the cell of interest (dark blue) at levels <img class="formulaInl" alt="$l=3$" src="./FMM_2D_ Main_Page_files/form_447.png"> to <img class="formulaInl" alt="$l=5$" src="./FMM_2D_ Main_Page_files/form_466.png"> are children, grandchildren or great grandchildren of the cell of interest at level <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png">.</p>
<div class="image">
<img src="./FMM_2D_ Main_Page_files/levels2to5.png" alt="levels2to5.png">
</div>
<p>For <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png"> and each cell <img class="formulaInl" alt="$(n,2)$" src="./FMM_2D_ Main_Page_files/form_445.png"> of level <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png">, we translate the far-field expansion of each cell in the interaction list of cell <img class="formulaInl" alt="$(n,2)$" src="./FMM_2D_ Main_Page_files/form_445.png">. Therefore, each cell <img class="formulaInl" alt="$(n,2)$" src="./FMM_2D_ Main_Page_files/form_445.png"> of level <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png"> has the potential calculations of its interaction list (each calculation is an series approximation) centered at <img class="formulaInl" alt="$x_c^{(n,2)}$" src="./FMM_2D_ Main_Page_files/form_446.png">, the center of cell <img class="formulaInl" alt="$(n,2)$" src="./FMM_2D_ Main_Page_files/form_445.png">. The interaction list of a cell consists of at most <img class="formulaInl" alt="$(3x 3 x 4) - (3 x 3 x 1) = (6 x 6) - (3 x 3) = 36 - 9 = 27$" src="./FMM_2D_ Main_Page_files/form_463.png"> cells. Therefore, we may be performing 27 translations to the cell center <img class="formulaInl" alt="$x_c^{(n,2)}$" src="./FMM_2D_ Main_Page_files/form_446.png"> in this step. All of the translated series now have the same center and can be written as a single expansion. We perform this procedure for every cell <img class="formulaInl" alt="$(n,2)$" src="./FMM_2D_ Main_Page_files/form_445.png"> at this level <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png">; that is, for <img class="formulaInl" alt="$4^l = 4^2 = 16$" src="./FMM_2D_ Main_Page_files/form_464.png"> cells.</p>
<ul>
<li><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Phi_3^{(n,2)} (y) = \Phi_4^{(n,2)}(y) \]" src="./FMM_2D_ Main_Page_files/form_456.png">
</p>
</li>
</ul>
<p>We go down to the next level <img class="formulaInl" alt="$l=3$" src="./FMM_2D_ Main_Page_files/form_447.png">. We proceed in the same manner and translate all far-field expansions for each cell in the interaction list of <img class="formulaInl" alt="$(n,3)$" src="./FMM_2D_ Main_Page_files/form_448.png"> to its center <img class="formulaInl" alt="$x_c^{(n,3)}$" src="./FMM_2D_ Main_Page_files/form_467.png">. Level <img class="formulaInl" alt="$l=3$" src="./FMM_2D_ Main_Page_files/form_447.png"> is the first level (working down from <img class="formulaInl" alt="$l=0$" src="./FMM_2D_ Main_Page_files/form_414.png">) that has cells beyond its interaction list. The cells are in cyan (light cyan) in the second figure from the left above. We can see that these are the cells of the interaction list of its parent <img class="formulaInl" alt="$(Parent(n,3),2)$" src="./FMM_2D_ Main_Page_files/form_468.png"> (seen the first figure, far left).</p>
<p>Now, the parent <img class="formulaInl" alt="$(Parent(n,3),2)$" src="./FMM_2D_ Main_Page_files/form_468.png"> of cell <img class="formulaInl" alt="$(n,3)$" src="./FMM_2D_ Main_Page_files/form_448.png"> has already collected the expansions of these cells of its interaction list in the previous step at <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png">. Therefore, to obtain this information (the single expansion) for cell <img class="formulaInl" alt="$(n,3)$" src="./FMM_2D_ Main_Page_files/form_448.png"> at its center <img class="formulaInl" alt="$x_c^{(n,3)}$" src="./FMM_2D_ Main_Page_files/form_467.png">, we need only perform a near-field to near-field translation from parent cell <img class="formulaInl" alt="$(Parent(n,3),2)$" src="./FMM_2D_ Main_Page_files/form_468.png"> to cell <img class="formulaInl" alt="$(n,3)$" src="./FMM_2D_ Main_Page_files/form_448.png"> of the single expansion.</p>
<p>We can now write all of the expansions that we have collected into a single series and the result is <img class="formulaInl" alt="$\Phi_3^{(n,3)}(y)$" src="./FMM_2D_ Main_Page_files/form_458.png">.</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Phi_3^{(n,3)}(y) = \Phi_4^{(n,3)}(y) + \Phi_4^{(Parent(n,3),2)}(y) \]" src="./FMM_2D_ Main_Page_files/form_460.png">
</p>
<p>We continue to work down the levels of refinement to <img class="formulaInl" alt="$l=4$" src="./FMM_2D_ Main_Page_files/form_461.png">. We translate the expansions of the cells in the interaction list of <img class="formulaInl" alt="$(n,4)$" src="./FMM_2D_ Main_Page_files/form_465.png"> to its center <img class="formulaInl" alt="$x_c^{(n,4)}$" src="./FMM_2D_ Main_Page_files/form_469.png">. From the previous step at <img class="formulaInl" alt="$l=3$" src="./FMM_2D_ Main_Page_files/form_447.png">, the parent <img class="formulaInl" alt="$(Parent(n,4),3)$" src="./FMM_2D_ Main_Page_files/form_475.png"> of <img class="formulaInl" alt="$(n,4)$" src="./FMM_2D_ Main_Page_files/form_465.png"> has a series <img class="formulaInl" alt="$\Phi_3^{(n,3)}(y)$" src="./FMM_2D_ Main_Page_files/form_458.png"> that is a collection of its interaction list expansions as well as its parent's interaction list expansions. Therefore, we need only translate this series to the center of cell <img class="formulaInl" alt="$(n,4)$" src="./FMM_2D_ Main_Page_files/form_465.png"> and we can form a single series that is <img class="formulaInl" alt="$\Phi_3^{(n,4)}(y)$" src="./FMM_2D_ Main_Page_files/form_476.png">.</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Phi_3^{(n,4)}(y) = \Phi_4^{(n,4)}(y) + \Phi_3^{(Parent(n,4),3)}(y) \]" src="./FMM_2D_ Main_Page_files/form_478.png">
</p>
<p>We continue this process until we reach the last level <img class="formulaInl" alt="$l=L$" src="./FMM_2D_ Main_Page_files/form_409.png">. We see that for <img class="formulaInl" alt="$l \geq 4$" src="./FMM_2D_ Main_Page_files/form_479.png">, the parent has recursively collected all of the information (series) from the cells outside the interaction list of the child cell (outside the parent's nearest neighbors - and this is <img class="formulaInl" alt="$\Phi)_3$" src="./FMM_2D_ Main_Page_files/form_481.png">). Therefore the following formula holds for <img class="formulaInl" alt="$l \geq 4$" src="./FMM_2D_ Main_Page_files/form_479.png"></p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Phi_3^{(n,l)}(y) = \Phi_4^{(n,l)}(y) + \Phi_3^{(Parent(n,l),l-1)}(y) \]" src="./FMM_2D_ Main_Page_files/form_480.png">
</p>
<p><b> Translation Formulas</b></p>
<p>Let's construct the formulas for the translations that take place in the downard pass. The first translation is the <img class="formulaInl" alt="$S|R$" src="./FMM_2D_ Main_Page_files/form_302.png"> translation of the far-field expansion at each cell in the interaction list of the cell <img class="formulaInl" alt="$(n,l)$" src="./FMM_2D_ Main_Page_files/form_451.png"> to its center <img class="formulaInl" alt="$x_c^{(n,l)}$" src="./FMM_2D_ Main_Page_files/form_483.png">. Recall that before the translation, the far-field expansion for each cell in the interaction list is centered at <img class="formulaInl" alt="$x_c^{(InteractionList(n,l),l)}$" src="./FMM_2D_ Main_Page_files/form_539.png">.</p>
<p>Recall the far field expansion for each cell <img class="formulaInl" alt="$(m,l)$" src="./FMM_2D_ Main_Page_files/form_489.png"> at level <img class="formulaInl" alt="$l$" src="./FMM_2D_ Main_Page_files/form_158.png"> </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Phi_1^{(m,l)}(y) = \sum_{k=0}^{\infty} C_k^{(n,l)} S_k(y-x_c^{(n,l)}) \]" src="./FMM_2D_ Main_Page_files/form_490.png">
</p>
<p> We start at the first refinement level <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png">. For a given cell <img class="formulaInl" alt="$(n,l)$" src="./FMM_2D_ Main_Page_files/form_451.png"> at level <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png">, we wish to translate each of these expansions for the cells <img class="formulaInl" alt="$(m,l)$" src="./FMM_2D_ Main_Page_files/form_489.png"> that are in the interaction list <img class="formulaInl" alt="$\left\{ (InteractionList(n,l),l) \right\}$" src="./FMM_2D_ Main_Page_files/form_491.png"> of cell <img class="formulaInl" alt="$(n,l)$" src="./FMM_2D_ Main_Page_files/form_451.png"> to the center <img class="formulaInl" alt="$x_c^{(n,l)}$" src="./FMM_2D_ Main_Page_files/form_483.png"> of the cell.</p>
<p>First, let's state the potentials due to sources in the interaction list <img class="formulaInl" alt="$E_4(n,l)$" src="./FMM_2D_ Main_Page_files/form_393.png">. </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Phi_4^{(n,l)}(y) = \sum_{m \in E_4(n,l)} u_m \Phi_1^{(m,l)}(y) \]" src="./FMM_2D_ Main_Page_files/form_488.png">
</p>
<p> We wish to translate each expansion <img class="formulaInl" alt="$\Phi_1^{(m,l)}(y)$" src="./FMM_2D_ Main_Page_files/form_492.png"> from the center <img class="formulaInl" alt="$x_c^{(m,l)}$" src="./FMM_2D_ Main_Page_files/form_493.png"> to <img class="formulaInl" alt="$x_c^{(n,l)}$" src="./FMM_2D_ Main_Page_files/form_483.png"> as well as change from a far-field <img class="formulaInl" alt="$S$" src="./FMM_2D_ Main_Page_files/form_325.png"> to a near-field <img class="formulaInl" alt="$R$" src="./FMM_2D_ Main_Page_files/form_324.png"> expansion. Using the <img class="formulaInl" alt="$(S|R)$" src="./FMM_2D_ Main_Page_files/form_444.png">-translation with <img class="formulaInl" alt="$y-x_*+t=y-x_c^{(m,l)}$" src="./FMM_2D_ Main_Page_files/form_494.png"> and <img class="formulaInl" alt="$y-x_*=y-x_c^{(n,l)}$" src="./FMM_2D_ Main_Page_files/form_495.png"> implying <img class="formulaInl" alt="$y-x_c^{(m,l)} = y-x_c^{(n,l)}+t$" src="./FMM_2D_ Main_Page_files/form_496.png"> and <img class="formulaInl" alt="$t = x_c^{(n,l)} - x_c^{(m,l)}$" src="./FMM_2D_ Main_Page_files/form_497.png"> we have </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \Phi_1^{(m,l)}(y) &amp;=&amp; \sum_{k=0}^{\infty} C_k^{(m,l)} S_k(y-x_c^{(m,l)}) \\ &amp; = &amp; \sum_{k=0}^{\infty} \hat{D}_k^{(m,l)} R_k(y-x_c^{(n,l)}) \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_519.png">
</p>
<p>where</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \hat{D}_0^{(m,l)} &amp; = &amp; C_0^{(m,l)} ln(x_c^{(n,l)} - x_c^{(m,l)}) + \sum_{j=1}^{\infty} C_j^{(m,l)} \frac{1}{(x_c^{(n,l)} - x_c^{(m,l)})} \\ \hat{D}_k^{(m,l)} &amp; = &amp; - \frac{C_0^{(m,l)}}{k (x_c^{(m,l)} - x_c^{(n,l)})^k} + \frac{1}{(x_c^{(m,l)} - x_c^{(n,l)})^k} \sum_{j=1}^{\infty} C_j^{(m,l)} \begin{pmatrix} j+k-1 \\ k \end{pmatrix} \frac{1}{(x_c^{(n,l)} - x_c^{(m,l)})^j} \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_503.png">
</p>
<p>We perform the translation for the far field expansion of every cell in the interaction list. The resulting expansions can then be written as a single series </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Phi_4^{(n,l)}(y) = \sum_{k=0}^{\infty} D_k^{(n,l)} R_k(y-x_c^{(n,l)}) \]" src="./FMM_2D_ Main_Page_files/form_506.png">
</p>
<p>where </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} D_0^{(n,l)} &amp;=&amp; \sum_{m \in E_4(n,l)} u_m \hat{D}_0^{(m,l)} \\ D_k^{(n,l)} &amp;=&amp; \sum_{m \in E_4(n,l)} u_m \hat{D}_k^{(m,l)} \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_508.png">
</p>
<p>The last translation in the Downward Pass is the <img class="formulaInl" alt="$(R|R)$" src="./FMM_2D_ Main_Page_files/form_509.png">-translation from the parent to the child of the far-field expansions that are outside the parent's nearest neighbors in <img class="formulaInl" alt="$E_3(Parent(n,l),l-1)$" src="./FMM_2D_ Main_Page_files/form_510.png"> (the parents interaction list as well as everything in the domain beyond the interaction list). Note that the nearest neighbors of the parent contain the cell of interest, its nearest neighbors and its interaction list. Therefore, the last translation in the Downward Pass takes into account the far field expansions that are in cells that are beyond cell <img class="formulaInl" alt="$(n,l)$" src="./FMM_2D_ Main_Page_files/form_451.png">'s interaction list.</p>
<p>Start with level <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png">. The interaction list of cell <img class="formulaInl" alt="$(n,l)$" src="./FMM_2D_ Main_Page_files/form_451.png"> is all that is in the domain <img class="formulaInl" alt="$E_1(0,0)$" src="./FMM_2D_ Main_Page_files/form_452.png"> beyond the nearest neighbors of the cell. We have just taken into account the interaction list in the previous step. We are done for <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png"> and do not have to consider the parent's interaction list or beyond.</p>
<p>We move on to level <img class="formulaInl" alt="$l=3$" src="./FMM_2D_ Main_Page_files/form_447.png">. We have taken into account the interaction list of cell <img class="formulaInl" alt="$(n,l)$" src="./FMM_2D_ Main_Page_files/form_451.png"> at this level. There is a parent interaction list for each cell at <img class="formulaInl" alt="$l=3$" src="./FMM_2D_ Main_Page_files/form_447.png"> as well. The far-field expansions for the cells in this interaction list have also been translated already to the parent cell and are written as a single expansion (as explained above). It is at this point that we do our first <img class="formulaInl" alt="$(R|R)$" src="./FMM_2D_ Main_Page_files/form_509.png">-translation. We translate to the center <img class="formulaInl" alt="$x_c^{(n,l)}$" src="./FMM_2D_ Main_Page_files/form_483.png"> </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \Phi_4^{(Parent(n,l),l-1))}(y) &amp;=&amp; \sum_{k=0}^{\infty} D_k^{(Parent(n,l),l-1)} R_k(y-x_c^{(Parent(n,l),l-1)}) \\ \sum_{k=0}^{\infty} E_k^{(n,l)} R_k(y-x_c^{(n,l)}) \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_546.png">
</p>
<p> Here, <img class="formulaInl" alt="$y-x_*+t = y - x_c^{(Parent(n,l),l-1)}$" src="./FMM_2D_ Main_Page_files/form_513.png"> and <img class="formulaInl" alt="$y-x_* = y - x_c^{(n,l)}$" src="./FMM_2D_ Main_Page_files/form_517.png"> implies <img class="formulaInl" alt="$t = x_c^{(n,l)} - x_c^{(Parent(n,l),l-1)}$" src="./FMM_2D_ Main_Page_files/form_515.png">. Therefore </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} E_k^{(n,l)} &amp;=&amp; \sum_{j=k}^{\infty} D_j^{(Parent(n,l),l-1)} \begin{pmatrix} j \\ k \end{pmatrix} (x_c^{(n,l)} - x_c^{(Parent(n,l),l-1)})^{j-k} \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_520.png">
</p>
<p>For each cell <img class="formulaInl" alt="$(n,l)$" src="./FMM_2D_ Main_Page_files/form_451.png"> at level <img class="formulaInl" alt="$l=3$" src="./FMM_2D_ Main_Page_files/form_447.png">, we now have a way to calculate <img class="formulaInl" alt="$\Phi_3^{(n,l)}(y)$" src="./FMM_2D_ Main_Page_files/form_457.png"> </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \Phi_3^{(n,l)}(y) &amp;=&amp; \Phi_4^{(n,l)}(y) + \Phi_3^{(Parent(n,l),l-1)}(y) \\ &amp;=&amp; \Phi_4^{(n,l)}(y) + \Phi_4^{(Parent(n,l),l-1)}(y) \\ &amp;=&amp; \sum_{k=0}^{\infty} \left( D_k^{(n,l)} + E_k^{(n,l)} \right) R_k(y-x_c^{(n,l)}) \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_522.png">
</p>
<p> where the second equation above is due to <img class="formulaInl" alt="$\Phi_3^{(n,l)}(y) = \Phi_4^{(n,l)}(y)$" src="./FMM_2D_ Main_Page_files/form_523.png"> for <img class="formulaInl" alt="$l=2$" src="./FMM_2D_ Main_Page_files/form_413.png">. Note that <img class="formulaInl" alt="$E_k^{(n,l)}$" src="./FMM_2D_ Main_Page_files/form_524.png"> is dependent on the <img class="formulaInl" alt="$D_k^{(Parent(n,l),l-1)}$" src="./FMM_2D_ Main_Page_files/form_525.png">'s determined in the previous step of the downward pass for the refinement <img class="formulaInl" alt="$l-1$" src="./FMM_2D_ Main_Page_files/form_526.png">.</p>
<p>Now that we have <img class="formulaInl" alt="$\Phi_3^{(n,l)}(y)$" src="./FMM_2D_ Main_Page_files/form_457.png"> for level <img class="formulaInl" alt="$l=3$" src="./FMM_2D_ Main_Page_files/form_447.png">, we can move on to level <img class="formulaInl" alt="$l=4$" src="./FMM_2D_ Main_Page_files/form_461.png">. First we carry out the <img class="formulaInl" alt="$(S|R)$" src="./FMM_2D_ Main_Page_files/form_444.png">-translation for the interaction list and then the translation for <img class="formulaInl" alt="$\Phi_3^{(Parent(n,l),l-1)}(y)$" src="./FMM_2D_ Main_Page_files/form_597.png">. In the cases <img class="formulaInl" alt="$l \geq 4$" src="./FMM_2D_ Main_Page_files/form_479.png">, we have a different situation since <img class="formulaInl" alt="$\Phi_3^{(Parent(n,l),l-1)}(y) \neq \Phi_4^{(Parent(n,l),l-1)}(y)$" src="./FMM_2D_ Main_Page_files/form_531.png"> (as was the case for <img class="formulaInl" alt="$l=3$" src="./FMM_2D_ Main_Page_files/form_447.png">). </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \Phi_3^{(n,l)}(y) &amp;=&amp; \Phi_4^{(n,l)}(y) + \Phi_3^{(Parent(n,l),l-1)}(y) \\ &amp;=&amp; \sum_{k=0}^{\infty} D_k^{(n,l)} R_k(y-x_c^{(n,l)}) + \sum_{k=0}^{\infty} \left( D_k^{(Parent(n,l),l-1)} + E_k^{(Parent(n,l),l-1)} \right) R_k(y-x_c^{(Parent(n,l),l-1)}) \\ &amp;=&amp; \sum_{k=0}^{\infty} D_k^{(n,l)} R_k(y-x_c^{(n,l)}) + \sum_{k=0}^{\infty} \hat{F}_k^{(Parent(n,l),l-1)} R_k(y-x_c^{(Parent(n,l),l-1)}) \\ \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_535.png">
</p>
<p> where <img class="formulaInl" alt="$\hat{F}_k^{(Parent(n,l),l-1)} = D_k^{(Parent(n,l),l-1)} + E_k^{(Parent(n,l),l-1)} $" src="./FMM_2D_ Main_Page_files/form_536.png">.</p>
<p>We translate the second series to <img class="formulaInl" alt="$x_c^{(n,l)}$" src="./FMM_2D_ Main_Page_files/form_483.png">. As with the <img class="formulaInl" alt="$(R|R)$" src="./FMM_2D_ Main_Page_files/form_509.png">-translation for <img class="formulaInl" alt="$\Phi_4^{(Parent(n,l),l-1)}(y)$" src="./FMM_2D_ Main_Page_files/form_532.png"> for level <img class="formulaInl" alt="$l=3$" src="./FMM_2D_ Main_Page_files/form_447.png"> we have </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \Phi_3^{(Parent(n,l),l-1)}(y) &amp;=&amp; \sum_{k=0}^{\infty} \hat{F}_k^{(Parent(n,l),l-1)} R_k(y-x_c^{(Parent(n,l),l-1)}) \\ &amp;=&amp; \sum_{k=0}^{\infty} F_k^{(n,l)} R_k(y-x_c^{(n,l)}) \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_537.png">
</p>
<p> where </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ F_k^{(n,l)} = \sum_{j=k}^{\infty} \hat{F}_j^{(Parent(n,l),l-1)} \begin{pmatrix} j \\ k \end{pmatrix} (x_c^{(n,l)} - x_c^{(Parent(n,l),l-1)})^{j-k} \]" src="./FMM_2D_ Main_Page_files/form_538.png">
</p>
<p>We repeat the process for <img class="formulaInl" alt="$l \geq 4$" src="./FMM_2D_ Main_Page_files/form_479.png"> until we reach <img class="formulaInl" alt="$l=L$" src="./FMM_2D_ Main_Page_files/form_409.png">.</p>
<p><b> Potential at Particle <img class="formulaInl" alt="$y$" src="./FMM_2D_ Main_Page_files/form_79.png"> </b></p>
<p>We are not in position to determine the potential <img class="formulaInl" alt="$\Phi(y)$" src="./FMM_2D_ Main_Page_files/form_540.png"> of particle <img class="formulaInl" alt="$y$" src="./FMM_2D_ Main_Page_files/form_79.png"> </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \Phi(y) &amp;=&amp; \sum_{i=1}^N u_i \Phi (y,x_i) \\ &amp;=&amp; \sum_{x_i \in E_2(n,l) \bigcup E_3(n,l)} u_i \Phi(y,x_i) \\ &amp;=&amp; \Phi_2^{(n,l)} (y) + \Phi_3^{(n,l)}(y) \\ \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_541.png">
</p>
<p>where for each <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> in <img class="formulaInl" alt="$E_2(n,l)$" src="./FMM_2D_ Main_Page_files/form_391.png"> we calculate <img class="formulaInl" alt="$\Phi (y,x_i) = \ln(\|y-x_i\|)$" src="./FMM_2D_ Main_Page_files/form_542.png"> directly (not using a series approximation).</p>
<h1><a class="anchor" id="mlfmm_complexity_section"></a>
MLFMM Complexity</h1>
<p>The Complexity of the Fast Multiple Method is developed below in stages. We follow the lecture of Gunnar Matinsson <a class="el" href="file:///home/dbpc/git/FMM2D/docs/html/citelist.html#CITEREF_martinsson2014">martinsson2014</a> and cast the problem as a matrix vector product <img class="formulaInl" alt="$u = Aq$" src="./FMM_2D_ Main_Page_files/form_606.png"> where <img class="formulaInl" alt="$A$" src="./FMM_2D_ Main_Page_files/form_607.png"> is the <img class="formulaInl" alt="$N x N$" src="./FMM_2D_ Main_Page_files/form_608.png"> matrix</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ A(i,j) = \log(x_i - y_j), \]" src="./FMM_2D_ Main_Page_files/form_610.png">
</p>
<p><img class="formulaInl" alt="$q = q(j,1)$" src="./FMM_2D_ Main_Page_files/form_611.png"> is the vector of charges for the sources <img class="formulaInl" alt="$y_j$" src="./FMM_2D_ Main_Page_files/form_0.png">, and <img class="formulaInl" alt="$N$" src="./FMM_2D_ Main_Page_files/form_612.png"> is the number of target particles <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png">. For our problem the targets and sources are the same.</p>
<h2><a class="anchor" id="slfmm_complexity_subsection"></a>
Single Level FMM Complexity</h2>
<p>In the single level fast multipole method (SLFMM) the domain is divided into a square grid of boxes (or cells). Recall that the potential of a particle <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> contained in a cell <img class="formulaInl" alt="$\tau$" src="./FMM_2D_ Main_Page_files/form_613.png"> is a sum of the contributions by each source particle <img class="formulaInl" alt="$y_j$" src="./FMM_2D_ Main_Page_files/form_0.png">.</p>
<p>Contributions to the potential are calculated directory ( <img class="formulaInl" alt="$ \log(x_i - y_j)$" src="./FMM_2D_ Main_Page_files/form_614.png">) for sources in boxes that are near neighbors of box <img class="formulaInl" alt="$\tau$" src="./FMM_2D_ Main_Page_files/form_613.png">. Contributions to the potential of <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> are series approximated for sources that are in boxes beyond the near neighbor boxes. We recall the Taylor series expansion</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \log(x) = \log(a) + \sum_{n=1}^{\infty} \frac{(-1)^n}{n a^n} (x-a)^n = \log(a) + \sum_{n=1}^{\infty} \frac{-1}{n a^n} (a-x)^n. \]" src="./FMM_2D_ Main_Page_files/form_622.png">
</p>
<p>Let <img class="formulaInl" alt="$c$" src="./FMM_2D_ Main_Page_files/form_617.png"> be the center of a box <img class="formulaInl" alt="$\sigma$" src="./FMM_2D_ Main_Page_files/form_618.png"> that is beyond the near neighbors of <img class="formulaInl" alt="$\tau$" src="./FMM_2D_ Main_Page_files/form_613.png"> and let source <img class="formulaInl" alt="$y_j$" src="./FMM_2D_ Main_Page_files/form_0.png"> be in box <img class="formulaInl" alt="$\sigma$" src="./FMM_2D_ Main_Page_files/form_618.png">. Then substituting <img class="formulaInl" alt="$x = x_i - y_j$" src="./FMM_2D_ Main_Page_files/form_620.png"> and <img class="formulaInl" alt="$a = x_i - c$" src="./FMM_2D_ Main_Page_files/form_621.png"></p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \log(x_i - y_j) = \log(x_i - c) + \sum_{n=1}^{\infty} \frac{-1}{n} \frac{1}{(x_i - c)^n} (y_j - c)^n \]" src="./FMM_2D_ Main_Page_files/form_619.png">
</p>
<p>Given a set <img class="formulaInl" alt="$J(\sigma)$" src="./FMM_2D_ Main_Page_files/form_623.png"> of sources located in box <img class="formulaInl" alt="$\sigma$" src="./FMM_2D_ Main_Page_files/form_618.png">, the contribution to the potential <img class="formulaInl" alt="$u(x_i)$" src="./FMM_2D_ Main_Page_files/form_624.png"> of <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> by the sources is</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \sum_{j \in J(\sigma)} \log(x_i - y_j) q_j &amp; \approx &amp; \sum_{j \in J(\sigma)} \left[ \log(x_i - c) q_j + \sum_{n=1}^P \frac{-1}{n} \frac{1}{(x-c)^n} (y_j - c)^n \right] q_j \\ &amp; = &amp; \log(x_i - c) \sum_{j \in J(\sigma)} q_j + \sum_{n=1}^P \frac{-1}{n} \frac{1}{(x-c)^n} \sum_{j \in J(\sigma)} (y_j - c)^n q_j \\ &amp; = &amp; \log(x_i - c) \hat{q}_0 + \sum_{n=1}^P \frac{-1}{n} \frac{1}{(x-c)^n} \hat{q}_n \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_654.png">
</p>
<p>where</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \hat{q}_0 = \sum_{j \in J(\sigma)} q_j \quad \mbox{ and } \quad \hat{q}_n = \sum_{j \in J(\sigma)} (y_j - c)^n q_j \]" src="./FMM_2D_ Main_Page_files/form_630.png">
</p>
<p>Recall that the target <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> and source <img class="formulaInl" alt="$y_j$" src="./FMM_2D_ Main_Page_files/form_0.png"> particles are the same for our problem. Also, there are <img class="formulaInl" alt="$m$" src="./FMM_2D_ Main_Page_files/form_75.png"> particle per box, <img class="formulaInl" alt="$N$" src="./FMM_2D_ Main_Page_files/form_612.png"> particles total. Therefore, the number of boxes at the single level is <img class="formulaInl" alt="$N_{boxes} = N/m$" src="./FMM_2D_ Main_Page_files/form_632.png">. For each particle <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> we have to</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} &amp;&amp; \mbox{ (i) calculate the P outgoing moments } \hat{q}_n \mbox{ for the particle } \quad \mbox{ Cost } = P \mbox{ operations}, \\ &amp;&amp; \mbox{ (ii) evaluate potential contributions from the } m \mbox{ particles in each of the 9 near neighbor boxes} \quad \mbox{Cost} = 9m \mbox{ operations} \\ &amp;&amp; \mbox{ (iii) evaluate potential contributions from the other } (N/m - 9) \mbox{ boxes } \quad \mbox{Cost} = (N/m - 9)P \mbox{ operations} \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_640.png">
</p>
<p>The last cost is a result of the <img class="formulaInl" alt="$P$" src="./FMM_2D_ Main_Page_files/form_637.png"> linear combinations <img class="formulaInl" alt="$\sum_{n=1}^P \frac{-1}{n} \frac{1}{(x-c)^n} \hat{q}_n$" src="./FMM_2D_ Main_Page_files/form_638.png">. Since this is to be performed for all <img class="formulaInl" alt="$N$" src="./FMM_2D_ Main_Page_files/form_612.png"> particles the cost is on the order of <img class="formulaInl" alt="$\frac{N^2}{m}$" src="./FMM_2D_ Main_Page_files/form_641.png">.</p>
<h2><a class="anchor" id="mlfmm_complexity_subsection"></a>
MultiLevel FMM Complexity</h2>
<p>To improve operation count further, multiple levels are introduced. The levels are <img class="formulaInl" alt="$l = 0$" src="./FMM_2D_ Main_Page_files/form_410.png"> with one cell, <img class="formulaInl" alt="$l = 1$" src="./FMM_2D_ Main_Page_files/form_411.png"> with 4 cells, <img class="formulaInl" alt="$l = 2$" src="./FMM_2D_ Main_Page_files/form_443.png"> with 16 cells, <img class="formulaInl" alt="$l = 3$" src="./FMM_2D_ Main_Page_files/form_642.png"> with <img class="formulaInl" alt="$64=4^3$" src="./FMM_2D_ Main_Page_files/form_643.png"> cells, ..., level l = L with <img class="formulaInl" alt="$4^{L}$" src="./FMM_2D_ Main_Page_files/form_644.png"> cells. At the lowest level <img class="formulaInl" alt="$l = L$" src="./FMM_2D_ Main_Page_files/form_417.png"> there are <img class="formulaInl" alt="$m$" src="./FMM_2D_ Main_Page_files/form_75.png"> particles per box and <img class="formulaInl" alt="$N_{boxes} = N/m$" src="./FMM_2D_ Main_Page_files/form_632.png"> boxes. The number of levels are <img class="formulaInl" alt="$L = \log_4(N_{boxes})$" src="./FMM_2D_ Main_Page_files/form_645.png">.</p>
<p>To determine the cost of the fast multipole method with multiple levels start with a particle <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png">. We calculate the outgoing moments for the particle <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> at each level. With <img class="formulaInl" alt="$L$" src="./FMM_2D_ Main_Page_files/form_378.png"> levels and <img class="formulaInl" alt="$P$" src="./FMM_2D_ Main_Page_files/form_637.png"> moments to calculate, the cost is <img class="formulaInl" alt="$LP$" src="./FMM_2D_ Main_Page_files/form_646.png">. With <img class="formulaInl" alt="$L = \log(N_{boxes}) = \log(N/m)$" src="./FMM_2D_ Main_Page_files/form_647.png"> the cost is <img class="formulaInl" alt="$O(\log(N))$" src="./FMM_2D_ Main_Page_files/form_648.png">. Here <img class="formulaInl" alt="$P,m &lt;&lt; N$" src="./FMM_2D_ Main_Page_files/form_649.png">.</p>
<p>Next we evaluate the potential contributions from the neighbors. The cost is <img class="formulaInl" alt="$9m$" src="./FMM_2D_ Main_Page_files/form_650.png">.</p>
<p>We now calculate the contributions from the well-separated particles. At the lowest level there are at most 27 boxes in the interaction list. Any particles further away than the interaction list will be in a bigger box. The linear combinations are formed for P moments of each box. The cost is 27P operations. We need to do this for every level and note that at each level there are at most 27 well-separated boxes. Therefore the total cost is <img class="formulaInl" alt="$27LP = 27P \log(N/m) = O(\log(N))$" src="./FMM_2D_ Main_Page_files/form_651.png">.</p>
<p>The sum of the operations is <img class="formulaInl" alt="$O(\log(N))$" src="./FMM_2D_ Main_Page_files/form_648.png">. Carrying the operations out for each of the <img class="formulaInl" alt="$N$" src="./FMM_2D_ Main_Page_files/form_612.png"> particles <img class="formulaInl" alt="$x_i$" src="./FMM_2D_ Main_Page_files/form_1.png"> we have <img class="formulaInl" alt="$O(N \log(N))$" src="./FMM_2D_ Main_Page_files/form_652.png">.</p>
<h2><a class="anchor" id="mlfmm_with_translation_operators_complexity_subsection"></a>
Complexity of MultiLevel FMM with Translation Operators</h2>
<p>In this situation, we have multiple levels as well as translation operators to take us up levels (far-field to far-field expansions), down levels (near-field to near-field expansions), and far-field to near-field expansions that change the center of the expansion (from a far source cell to the near target cell).</p>
<p>To compute the outgoing expansions, we first compute the <img class="formulaInl" alt="$P$" src="./FMM_2D_ Main_Page_files/form_637.png"> multipoles for each of the <img class="formulaInl" alt="$m$" src="./FMM_2D_ Main_Page_files/form_75.png"> particles in each box <img class="formulaInl" alt="$\tau$" src="./FMM_2D_ Main_Page_files/form_613.png"> existing at the lowest level <img class="formulaInl" alt="$l = L$" src="./FMM_2D_ Main_Page_files/form_417.png">. The cost totals to <img class="formulaInl" alt="$PN$" src="./FMM_2D_ Main_Page_files/form_653.png">. Since the multipoles for each particle of box <img class="formulaInl" alt="$\tau$" src="./FMM_2D_ Main_Page_files/form_613.png"> have the same center we can sum them as in</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray*} \sum_{j \in J(\sigma)} \log(x_i - y_j) q_j &amp; \approx &amp; \sum_{j \in J(\sigma)} \left[ \log(x_i - c) q_j + \sum_{n=1}^P \frac{-1}{n} \frac{1}{(x-c)^n} (y_j - c)^n \right] q_j \\ &amp; = &amp; \log(x_i - c) \sum_{j \in J(\sigma)} q_j + \sum_{n=1}^P \frac{-1}{n} \frac{1}{(x-c)^n} \sum_{j \in J(\sigma)} (y_j - c)^n q_j \\ &amp; = &amp; \log(x_i - c) \hat{q}_0 + \sum_{n=1}^P \frac{-1}{n} \frac{1}{(x-c)^n} \hat{q}_n \end{eqnarray*}" src="./FMM_2D_ Main_Page_files/form_654.png">
</p>
<p>Therefore, we have <img class="formulaInl" alt="$P$" src="./FMM_2D_ Main_Page_files/form_637.png"> multipoles for each box at the lowest level <img class="formulaInl" alt="$l = L$" src="./FMM_2D_ Main_Page_files/form_417.png">. Our next step is to translate the multipoles up to the next level <img class="formulaInl" alt="$l = L-1$" src="./FMM_2D_ Main_Page_files/form_416.png">. Each cell at level <img class="formulaInl" alt="$l = L$" src="./FMM_2D_ Main_Page_files/form_417.png"> is a daughter of a parent cell at level <img class="formulaInl" alt="$l = L-1$" src="./FMM_2D_ Main_Page_files/form_416.png">. In 2D there are 4 daughter cells for each parent cell (in 3D there are 8 daughter cells per parent). We translate the <img class="formulaInl" alt="$P$" src="./FMM_2D_ Main_Page_files/form_637.png"> multipoles from each daughter to the parent. The translation is a <img class="formulaInl" alt="$P-by-P$" src="./FMM_2D_ Main_Page_files/form_655.png"> matrix. The cost for the translation of a cell's multipoles is order <img class="formulaInl" alt="$O(P^2)$" src="./FMM_2D_ Main_Page_files/form_656.png">.</p>
<p>We perform this for all <img class="formulaInl" alt="$N/m$" src="./FMM_2D_ Main_Page_files/form_657.png"> boxes at level <img class="formulaInl" alt="$l=L$" src="./FMM_2D_ Main_Page_files/form_409.png"> and have <img class="formulaInl" alt="$O(NP^2/m) = O(NP^2)$" src="./FMM_2D_ Main_Page_files/form_658.png">. At the next level we will perform the same procedure, but to a level having one-fourth of the cells. The cost will be <img class="formulaInl" alt="$\frac{1}{4} NP^2$" src="./FMM_2D_ Main_Page_files/form_659.png">. Translating up to the next level will cost <img class="formulaInl" alt="$\frac{1}{4^2} NP^2$" src="./FMM_2D_ Main_Page_files/form_660.png">. The summation continues until we reach the top level. The total cost is bounded by the geometric series</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \mbox{Upward Pass Cost} = \sum_{n=0}^{L} \frac{1}{4^n} NP^2 \leq \frac{1}{1-\frac{1}{4}} NP^2 = \frac{4}{3} NP^2 = O(NP^2) \]" src="./FMM_2D_ Main_Page_files/form_662.png">
</p>
<p>Our next step is the translation of the far-field multipoles to near-field multipoles. In 2D the interaction list can have at most 27 members. A cell can have at most 9 near neighbors. The interaction list consists of the children of the near-neighbors of the cell's parent, where the children are not also near neighbors of the cell. The parent can have at most 9 near-neighbors (including itself). Therefore there are <img class="formulaInl" alt="$(9)(4) = 36$" src="./FMM_2D_ Main_Page_files/form_663.png"> children that are potential interaction list cells minus the 9 possible near neighbors of the cell, resulting in 27 total possible interaction list cells.</p>
<p>At each level, each cell must translate at most 27 other cell's <img class="formulaInl" alt="$P$" src="./FMM_2D_ Main_Page_files/form_637.png"> multipoles. This is part of the downward pass. We can however, start our operation count from the lowest level. At the lowest level there are <img class="formulaInl" alt="$N/m$" src="./FMM_2D_ Main_Page_files/form_657.png"> boxes and each box must translate <img class="formulaInl" alt="$P$" src="./FMM_2D_ Main_Page_files/form_637.png"> multipoles from 27 other possible boxes of their interaction list. The translation is a <img class="formulaInl" alt="$P-by-P$" src="./FMM_2D_ Main_Page_files/form_655.png"> matrix and the total cost is</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \left( \frac{N}{m} \right) (27)(P^2) = O(27NP^2) \]" src="./FMM_2D_ Main_Page_files/form_664.png">
</p>
<p>We will do this at every level. As we work our way up the levels to count the costs, the cells decrease by <img class="formulaInl" alt="$\frac{1}{4}$" src="./FMM_2D_ Main_Page_files/form_665.png">. Again, we have a geomtric sequence with upper bound</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \mbox{Downward Pass Part I Cost} = \sum_{n=0}^{L} \frac{1}{4^n} 27NP^2 \leq \frac{1}{1-\frac{1}{4}} NP^2 = \frac{4}{3} NP^2 = O(27NP^2) \]" src="./FMM_2D_ Main_Page_files/form_666.png">
</p>
<p>Next we calculate the cost to translate these multipoles down to each cell at the lowest level <img class="formulaInl" alt="$l = L$" src="./FMM_2D_ Main_Page_files/form_417.png">. At the top level we must translate the <img class="formulaInl" alt="$P$" src="./FMM_2D_ Main_Page_files/form_637.png"> multipoles of a cell to the 4 children cells. Once we translate to a child cell, we translate the <img class="formulaInl" alt="$P$" src="./FMM_2D_ Main_Page_files/form_637.png"> multipoles of that child cell to its 4 children cells. We continue this process for each level until reaching the lowest level <img class="formulaInl" alt="$l = L$" src="./FMM_2D_ Main_Page_files/form_417.png">.</p>
<p>To tally up the cost, we consider this process in reverse (upwards) and count it like the far-field to far-field translations from the children to the parent, instead of parent to children. The translation is a <img class="formulaInl" alt="$P-by-P$" src="./FMM_2D_ Main_Page_files/form_655.png"> matrix and the cost of a translation is <img class="formulaInl" alt="$O(P^2)$" src="./FMM_2D_ Main_Page_files/form_656.png">. Like the Upward Pass, at the lowest level the cost to translate from the children to the parent is <img class="formulaInl" alt="$O(NP^2)$" src="./FMM_2D_ Main_Page_files/form_667.png">. Then at the next highest level the number of cell's is reduced by <img class="formulaInl" alt="$\frac{1}{4}$" src="./FMM_2D_ Main_Page_files/form_665.png">. Since this upward process is equivalent to progressing downward we have the cost</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \mbox{Downward Pass Part II Cost} = \sum_{n=0}^{L} \frac{1}{4^n} NP^2 \leq \frac{1}{1-\frac{1}{4}} NP^2 = \frac{4}{3} NP^2 = O(NP^2) \]" src="./FMM_2D_ Main_Page_files/form_668.png">
</p>
<p>Finally, we are at the lowest level and we perform the direct calculations for the contributions by the <img class="formulaInl" alt="$9m$" src="./FMM_2D_ Main_Page_files/form_650.png"> particles in the near neighbor cells of the <img class="formulaInl" alt="$N$" src="./FMM_2D_ Main_Page_files/form_612.png"> particles. The cost is <img class="formulaInl" alt="$9mN$" src="./FMM_2D_ Main_Page_files/form_669.png">. We also calculate the final expansion for each of the <img class="formulaInl" alt="$N$" src="./FMM_2D_ Main_Page_files/form_612.png"> target particles. The cost is <img class="formulaInl" alt="$NP$" src="./FMM_2D_ Main_Page_files/form_670.png">. The overall cost for the last part of the method is <img class="formulaInl" alt="$O(N)$" src="./FMM_2D_ Main_Page_files/form_671.png"></p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \mbox{Evaluation Cost} = 9mN + NP = O(N) \]" src="./FMM_2D_ Main_Page_files/form_672.png">
</p>
<p>With <img class="formulaInl" alt="$P \approx 20$" src="./FMM_2D_ Main_Page_files/form_673.png"> and <img class="formulaInl" alt="$P &lt;&lt; N$" src="./FMM_2D_ Main_Page_files/form_674.png">, we see the MLFMM with Translation Operations costs <img class="formulaInl" alt="$O(N)$" src="./FMM_2D_ Main_Page_files/form_671.png">. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"><address class="footer"><small>
Generated on Mon Nov 20 2017 13:24:44 for FMM 2D by &nbsp;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="./FMM_2D_ Main_Page_files/doxygen.png" alt="doxygen">
</a> 1.8.6
</small></address>


</body></html>